<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
	<title>Badminton Scoreboard + BWF-Style Fixtures</title>
	<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
	<style>
		:root {
			--accent: #ffca28;
			--glow: #ffee58;
			--bg: #0a0a0a;
			--green: #4caf50;
			--red: #f44336;
			--blue: #2196f3;
			--ink: #e8e8ea;
			--muted: #a9acb3;
			--panel: #0f1114;
			--panel2: #0b0d10;
			--line: #1b1f26;
			--purple: #6f42c1;
			--gray: #666;
		}

		* {
			box-sizing: border-box;
		}

		html, body {
		  height: 100%;
			 margin: 0;
			 background: var(--bg);
			 color: #fff;
			 font-family: 'Poppins', sans-serif;
			 -webkit-font-smoothing: antialiased;
		}

		.container {
			max-width: 1100px;
			margin: 0 auto;
			padding: 18px;
		}

		/* shared header row */
		.header-row {
			display: flex;
			align-items: center;
			gap: 10px;
			justify-content: space-between;
			margin-bottom: 10px;
		}

		.link-btn {
			background: transparent;
			border: none;
			color: var(--accent);
			font-weight: 800;
			cursor: pointer;
		}

		h1 {
			font-family: 'Orbitron', sans-serif;
			color: var(--accent);
			margin: 8px 0 14px;
			font-size: 26px;
		}

		/* ===== SCOREBOARD ===== */
		.board {
			background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
			border-radius: 14px;
			padding: 18px;
			border: 1px solid rgba(255, 255, 255, 0.04);
			box-shadow: 0 14px 50px rgba(0, 0, 0, 0.6);
		}

		.players {
			display: flex;
			gap: 20px;
			justify-content: space-between;
			flex-wrap: wrap;
		}

		.player {
			flex: 1;
			min-width: 260px;
			display: flex;
			flex-direction: column;
			align-items: center;
			padding: 12px;
			border-radius: 12px;
		}

		.flag-btn {
			background: transparent;
			border: none;
			cursor: pointer;
			padding: 6px;
			border-radius: 8px;
			display: flex;
			align-items: center;
			gap: 8px;
			touch-action: manipulation;
			-webkit-tap-highlight-color: transparent;
		}

		.flag-img {
			width: 64px;
			height: 46px;
			object-fit: cover;
			border-radius: 8px;
			border: 2px solid rgba(0, 0, 0, 0.6);
			box-shadow: 0 10px 26px rgba(0, 0, 0, 0.5);
		}

		.player-name {
			margin-top: 10px;
			color: #ddd;
			font-size: 16px;
			font-weight: 600;
			text-align: center;
			min-height: 42px;
			outline: none;
			white-space: pre-wrap;
			word-wrap: break-word;
		}

		.country-label {
			margin-top: 6px;
			color: #ddd;
			font-size: 13px;
			opacity: 0.9;
		}

		.score-box {
			margin-top: 14px;
			background: linear-gradient(180deg, #020202, #0b0b0b);
			border-radius: 14px;
			padding: 14px 20px;
			border: 2px solid rgba(255, 255, 255, 0.04);
			min-width: 150px;
			display: flex;
			align-items: center;
			justify-content: center;
			box-shadow: inset 0 -8px 28px rgba(0, 0, 0, 0.6);
		}

		.score {
			font-family: 'Orbitron', sans-serif;
			font-size: 64px;
			color: var(--accent);
			text-shadow: 0 0 18px var(--glow), 0 0 48px rgba(255, 202, 40, 0.12);
		}

		.games {
			margin-top: 10px;
			color: #00e676;
			font-weight: 600;
		}

		.controls {
			display: flex;
			gap: 12px;
			margin-top: 14px;
		}

		.btn {
			padding: 12px 16px;
			border-radius: 10px;
			border: none;
			font-size: 18px;
			color: #fff;
			cursor: pointer;
			touch-action: manipulation;
			-webkit-tap-highlight-color: transparent;
		}

		.btn.plus {
			background: linear-gradient(180deg, var(--green), #2e8e46);
			box-shadow: 0 6px 18px rgba(76, 175, 80, 0.14);
		}

		.btn.minus {
			background: linear-gradient(180deg, var(--red), #d23b30);
			box-shadow: 0 6px 18px rgba(244, 67, 54, 0.14);
		}

		.reset {
			display: block;
			margin: 20px auto;
			padding: 12px 28px;
			background: linear-gradient(180deg, var(--blue), #1976d2);
			border-radius: 12px;
			color: #fff;
			border: none;
			font-weight: 700;
			touch-action: manipulation;
		}

		.winnerText {
			margin-top: 12px;
			color: #00e676;
			font-weight: 700;
			text-shadow: 0 0 10px #00e676;
		}

		/* history */
		.history {
			margin-top: 18px;
			padding: 12px 14px;
			border-radius: 10px;
			background: rgba(255, 255, 255, 0.02);
			color: #fff;
			font-size: 15px;
		}

		.history h3 {
			margin: 0 0 8px 0;
			color: #ffd;
			font-weight: 700;
			font-size: 16px;
		}

		.history ul {
			list-style: none;
			padding: 0;
			margin: 0;
			max-height: 220px;
			overflow: auto;
		}

		.history li {
			padding: 8px 6px;
			border-bottom: 1px solid rgba(255, 255, 255, 0.02);
			color: #ddd;
			text-align: left;
			font-size: 14px
		}

		.clear-history {
			margin-top: 10px;
			display: none;
			background: transparent;
			border: 1px solid rgba(255, 255, 255, 0.06);
			color: #fff;
			padding: 8px 10px;
			border-radius: 8px;
			cursor: pointer
		}

		/* winner overlay */
		.overlay {
			position: fixed;
			inset: 0;
			display: none;
			align-items: center;
			justify-content: center;
			z-index: 2000;
		}

		.overlay.visible {
			display: flex;
		}

		.overlay-inner {
			position: relative;
			width: 100%;
			height: 100%;
			background: rgba(0,0,0,0.85);		
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 20px;
		}

		.winner-flag {
			width: 280px;
			height: 180px;
			object-fit: cover;
			border-radius: 14px;
			border: 6px solid rgba(255, 255, 255, 0.04);
			box-shadow: 0 18px 60px rgba(0, 0, 0, 0.75);
		}

		.winner-title {
			font-family: 'Orbitron', sans-serif;
			font-size: 38px;
			color: var(--accent);
			text-shadow: 0 0 22px var(--glow);
			margin-top: 18px;
			text-align: center;
		}

		.close-btn {
			margin-top: 22px;
			padding: 12px 22px;
			border-radius: 12px;
			border: none;
			background: rgba(255, 255, 255, 0.06);
			color: #fff;
			font-weight: 800;
			cursor: pointer;
			touch-action: manipulation;
		}

		#confettiCanvas {
			position: absolute;
			inset: 0;
			z-index: 1999;
			pointer-events: none;
		}

		/* ===== FLAG PICKER (icons only) ===== */
		.flag-modal-backdrop {
			position: fixed;
			inset: 0;
			background: rgba(0, 0, 0, 0.55);
			display: none;
			align-items: center;
			justify-content: center;
			z-index: 2200;
		}

		.flag-modal {
			background: #0f1012;
			border-radius: 12px;
			padding: 12px;
			width: 320px;
			max-width: 90%;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
			border: 1px solid rgba(255, 255, 255, 0.04);
		}

		.flag-modal h4 {
			margin: 0 0 8px 0;
			color: var(--accent);
			font-family: 'Orbitron', sans-serif;
			font-size: 16px;
			text-align: center;
		}

		.flag-grid {
			display: grid;
			grid-template-columns: repeat(5, 1fr);
			gap: 0px;
		}

		.flag-choice {
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 6px;
			background: #0b0d10;
			border-radius: 8px;
			cursor: pointer;
			border: 1px solid rgba(255, 255, 255, 0.06);
		}

		.flag-choice img {
			width: 44px;
			height: 30px;
			border-radius: 6px;
			object-fit: cover;
		}

		/* ===== FIXTURE VIEW (BWF-Style) ===== */
		.hidden {
			display: none;
		}

		.fixture-shell {
			background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
			border-radius: 14px;
			padding: 16px;
			border: 1px solid rgba(255, 255, 255, 0.04);
			box-shadow: 0 14px 50px rgba(0, 0, 0, 0.6);
		}

		.fixture-header {
			display: flex;
			align-items: center;
			gap: 10px;
			justify-content: space-between;
			margin-bottom: 8px;
		}

		/* ===== BWF-style category dropdown (UPDATED to match BWF panel) ===== */
		.cat-wrap{
		  position: relative;
		  width: 100%;
		  margin-top: 14px;
		  display:flex;
		  justify-content:center;
		}
		
		/* the black pill (MS + chevron) */
		.cat-pill{
		  width: min(720px, 92vw);
		  height: 74px;
		  background: #000;
		  border: 1px solid rgba(255,255,255,.10);
		  border-radius: 22px;
		  color: #fff;
		  cursor: pointer;
		
		  display:flex;
		  align-items:center;
		  justify-content:center;
		
		  box-shadow:
		    inset 0 0 0 1px rgba(255,255,255,.03),
		    0 14px 40px rgba(0,0,0,.55);
		}
		
		.cat-pill-inner{
		  display:inline-flex;
		  align-items:center;
		  justify-content:center;
		  gap: 12px;
		}
		
		.cat-label{
		  font-weight: 900;
		  letter-spacing: .08em;
		  font-size: 22px;
		}
		
		.cat-chev{
		  width: 22px;
		  height: 22px;
		  opacity: .95;
		  display:block;
		  transform: translateY(1px) rotate(0deg);
		  transform-origin:center;
		  transition: transform .18s ease;
		}
		#catPill[aria-expanded="true"] .cat-chev{
		  transform: translateY(1px) rotate(180deg);
		}
		
		/* the big blue menu panel */
		.cat-menu{
		  display:none;
		  flex-direction:column;
		  position:absolute;
		  top: 86px;
		  left: 50%;
		  transform: translateX(-50%);
		  width: min(720px, 92vw);
		
		  border-radius: 20px;
		  overflow:hidden;
		  z-index: 9999;
		
		  background: linear-gradient(
		    180deg,
		    rgba(18,18,18,0.98) 0%,
		    rgba(14,14,14,0.96) 50%,
		    rgba(10,10,10,0.94) 100%
		  ) !important;
		
		  border: 1px solid rgba(255,255,255,0.08) !important;
		  box-shadow:
		    0 25px 60px rgba(0,0,0,0.75),
		    inset 0 1px 0 rgba(255,255,255,0.04) !important;		  
		}
		
		.cat-menu.visible{ display:flex; }
		
		/* title row inside menu */
		.cat-title{
		  padding: 18px 16px;
		  text-align:center;
		  font-weight: 800;
		  letter-spacing: .04em;
		  color: rgba(255,255,255,.92);
		  background: rgba(0,0,0,.18);
		  border-bottom: 1px solid rgba(255,255,255,.10);
		}
		
		/* items like MS / WS / MD ... */
		.cat-item{
		  padding: 22px 16px;
		  text-align:center;
		  font-size: 22px;
		  font-weight: 900;
		  letter-spacing: .10em;
		  color: rgba(255,255,255,.95);
		  background: transparent;
		  border-top: 1px solid rgba(255,255,255,.10);
		}
		
		.cat-item:first-of-type{ border-top: none; }
		
		.cat-item:hover{
		  background: rgba(255,255,255,.06);
		}		

		/* input stage */
		.input-panel {
			background: #0c0f13;
			border: 1px solid #1b1f26;
			border-radius: 12px;
			padding: 14px;
		}

		.input-row {
			display: flex;
			gap: 10px;
			align-items: center;
			flex-wrap: wrap;
			margin-bottom: 10px;
		}

		.slabel {
			opacity: .8;
		}

		.select {
			background: #0d1116;
			border: 1px solid #1b1f26;
			color: #fff;
			border-radius: 10px;
			padding: 10px 12px;
		}

		.player-line {
			display: flex;
			gap: 8px;
		}

		.player-line input {
			flex: 1;
			background: #0b0d10;
			border: 1px solid #1b1f26;
			color: #eaecef;
			border-radius: 10px;
			padding: 10px 12px;
		}

		.flag-mini {
			width: 36px;
			height: 26px;
			border-radius: 6px;
			border: 1px solid #222;
			cursor: pointer;
		}

		.actions {
			display: flex;
			gap: 10px;
			justify-content: flex-end;
			margin-top: 10px;
		}

		.primary {
			background: var(--accent);
			color: #000;
			font-weight: 800;
			border: none;
			border-radius: 10px;
			padding: 10px 14px;
			cursor: pointer;
		}

		.ghost {
			background: transparent;
			border: 1px solid #1b1f26;
			color: #ddd;
			border-radius: 10px;
			padding: 10px 14px;
			cursor: pointer;
		}

		.match-number {
			width: 28px;
			color: #aaa;
			font-size: 13px;
			text-align: center;
		}

		.flag-circle {
			width: 26px;
			height: 26px;
			border-radius: 50%;
			object-fit: cover;
		}

		.name {
			font-weight: 500;
			color: #fff;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			max-width: 140px;
		}

		.score {
			font-weight: 700;
			font-family: 'Orbitron', sans-serif;
			font-size: 15px;
			color: #ffdf91;
			margin-right: 6px;
		}

		.dot-win {
			width: 8px;
			height: 8px;
			border-radius: 50%;
			background: #00e676;
		}

		.dot-empty {
			width: 8px;
			height: 8px;
			border-radius: 50%;
			border: 1px solid #555;
		}

		@media(max-width:900px) {
			.name {
				max-width: 110px;
			}
		}

		/* action buttons on each match card */
		.match-actions {
			display: flex;
			justify-content: flex-end;
			gap: 8px;
			padding: 8px 10px 10px;
			border-top: 1px solid #1b1b1b;
			background: #0f0f0f;
			border-radius: 0 0 10px 10px;
		}

		.play-btn,
		.manual-btn {
			font-size: 12px;
			padding: 6px 10px;
			border-radius: 6px;
			cursor: pointer;
			border: none;
		}

		.play-btn {
			background: var(--accent);
			color: #000;
			font-weight: 800;
		}

		.manual-btn {
			background: transparent;
			border: 1px solid #333;
			color: #bbb;
		}

		.play-btn:active,
		.manual-btn:active {
			transform: translateY(1px);
		}

		/* synced indicator */
		.synced-badge {
			position: absolute;
			bottom: 6px;
			right: 10px;
			font-size: 12px;
			color: #00e676;
			font-weight: 700;
			opacity: 0.9;
			pointer-events: none;
		}

		/* ===== END OF BRACKET SECTION ===== */

		/* manual score modal */
		.manual-score-modal {
			position: fixed;
			inset: 0;
			background: rgba(0, 0, 0, 0.8);
			display: none;
			align-items: center;
			justify-content: center;
			z-index: 2200;
		}

		.manual-score-modal.visible {
			display: flex;
		}

		.manual-form {
		  background: #0f1012;
		  border-radius: 12px;
		  padding: 16px;
		  width: 90%;               /* responsive width */
		  max-width: 400px;         /* fits all phones, no overflow */
		  box-sizing: border-box;   /* ensures width includes padding */
		  margin: 0 auto;           /* center inside overlay */
		  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
		}		

		.manual-form h4 {
			margin: 0 0 12px;
			color: var(--accent);
			font-size: 18px;
			text-align: center;
		}

		.manual-form .game-row {
			 display: flex;
			 gap: 10px;
			 margin-bottom: 8px;
		}

		.manual-form input {
		  width: 42%;                /* make each box shorter */
		  max-width: 42%;
		  flex: 0 0 auto;            /* stop it from stretching */
		  background: #0b0d10;
		  border: 1px solid #1b1f26;
		  color: #fff;
		  border-radius: 8px;
		  padding: 10px;
		  font-size: 14px;
		  box-sizing: border-box;    /* padding stays inside 42% */
		}		

		.manual-form .actions {
			 justify-content: center;
			 margin-top: 12px;
		}

		/* === Responsive Connector Alignment Fix === */
		.bracket-canvas {
			 position: relative;
			 overflow-x: auto;
		 	overflow-y: hidden;
			 height: auto !important;
			 /* ‚Üê FIX */
		 	min-height: 100%;
			 /* ‚Üê FIX */
			 padding: 20px 0;
			 background: #0b0b0b;
		}

		/* ==== BWF STYLE MATCH CARD ==== */
		/* ==== TRUE BWF-STYLE FIXTURE LAYOUT ==== */
		.match {
			position: relative;
			background: #101010;
			border-radius: 10px;
			margin: 6px 0;
			height: 120px;
			overflow: visible;
			border: 1px solid #1d1d1d;
			box-sizing: border-box;
		}

		.match:hover {
			transform: translateY(-2px);
		}

		.match-number {
			font-size: 13px;
			color: #888;
			width: 18px;
			text-align: right;
			margin-right: 6px;
		}

		.flag-circle {
			width: 24px;
			height: 24px;
			border-radius: 50%;
			object-fit: cover;
			margin-right: 6px;
			box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
		}

		.name {
			flex: 1;
			font-size: 13.5px;
			color: #f4f4f4;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.score-set {
			display: flex;
			gap: 2px;
			font-size: 13.5px;
			color: #f5f5f5;
			font-weight: 600;
			min-width: 0px;			
		}
		/* winner row: the row that contains the green winner-dot */
  .match-row:has(.winner-dot) .score-set {
  color: #d93025;   /* red for winner, like BWF */
  }
		
		.win-score {
    color: #ff3b30 !important;   /* red like BWF */
    font-weight: 700;
  }

  .lose-score {
    color: #ffffff !important;   /* white score */
    opacity: 0.85;
  }

		.match-actions {
			display: flex;
			justify-content: flex-end;
			gap: 8px;
			padding: 6px 8px 8px;
			border-top: 1px solid #1b1b1b;
			background: #0e0e0e;
		}

		.play-btn,
		.manual-btn {
			font-size: 11.5px;
			padding: 5px 9px;
			border-radius: 6px;
			cursor: pointer;
			border: none;
		}

		.play-btn {
			background: var(--accent);
			color: #000;
			font-weight: 800;
		}

		.manual-btn {
			background: transparent;
			border: 1px solid #333;
			color: #bbb;
		}

		.name.bye {
			color: #777;
			font-style: italic;
		}

		/* === MULTI-ROUND BRACKET LAYOUT (BWF STYLE) === */
		.round-col-title {
			font-family: 'Orbitron', sans-serif;
			font-weight: 800;
			color: var(--accent);
			margin: 6px 8px;
		}

		/* container + SVG overlay */
		/* === FIXED BWF BRACKET LAYOUT === */
		#bracketContainer {
			position: relative;
			overflow-x: auto;
			/* allow horizontal scroll under the hood */
			overflow-y: hidden;
			width: 100%;
			padding-bottom: 10px;
		}

		/* optional: tiny scrollbar so it doesn't look ugly */
		#bracketContainer::-webkit-scrollbar {
			height: 6px;
		}

		#bracketContainer::-webkit-scrollbar-track {
			background: #050505;
		}

		#bracketContainer::-webkit-scrollbar-thumb {
			background: #333;
			border-radius: 3px;
		}

		.round-wrap {
			 position: relative;
		  display: flex !important;
			 /* ‚¨ÖÔ∏è side-by-side columns */
		 	align-items: flex-start;
		 	gap: 40px;
			 overflow: visible !important;
		}

		.round-col {
			 display: flex;
			 flex-direction: column;
			 position: relative;
		}

		.match.tbd {
			 opacity: 0.4;
		}

		.match-index {
			width: 26px;
			font-size: 16px;
			font-weight: 700;
			color: #ffd54f;
			text-align: center;
			margin-right: 6px;
			opacity: 0.9;
		}

		/* === WALKOVER BANNER === */
		.walkover-banner {
				position: sticky;
				bottom: 0;
				left: 0;
				width: 100%;
				background: #000;
				color: #fff;
				text-align: center;
				font-weight: 600;
				padding: 12px 0;
				border-top: 1px solid rgba(255, 255, 255, 0.08);
				font-family: 'Poppins', sans-serif;
				font-size: 15px;
				z-index: 999;
		}

		.wo-box {
				display: inline-block;
				background: #fff;
				color: #000;
				font-weight: 800;
				border-radius: 4px;
				padding: 3px 6px;
				margin-right: 6px;
				font-size: 13px;
				letter-spacing: 0.5px;
		}

		.walkover-banner.hidden {
			 display: none;
		}

		.bottom-actions {
				display: flex;
				justify-content: center;
				gap: 12px;
				margin: 25px 0;
		}

		.action-btn {
				background: #222;
				color: #ffcc00;
				border: 1px solid #ffcc00;
				padding: 10px 18px;
				border-radius: 8px;
				font-weight: 600;
				font-family: 'Poppins', sans-serif;
				transition: none;
				cursor: pointer;
				display: flex;
				align-items: center;
				gap: 8px;
		}

		.action-btn:hover {
			background: #ffcc00;
			color: #000;
			transform: translateY(-2px);
		}

		.action-btn.reset {
			border-color: #ff5555;
			color: #ff5555;
		}

		.action-btn.reset:hover {
			background: #ff5555;
			color: #fff;
		}

		/* Make Edit Players match Reset button's size */
		.action-btn.edit {
			background: #ffcc00;
			border: 1px solid #ffcc00;
			color: #000;
			width: 100px;
			/* match reset button */
			height: 44px;
		}

		.action-btn.edit i {
			margin-right: 1px;
			/* spacing between icon + text */
		}

		.action-btn.edit:hover {
			background: #ffd84d;
			border-color: #ffd84d;
			color: #000;
		}

		.bottom-actions {
			display: flex;
			justify-content: center;
			align-items: center;
			/* <‚Äî FIXES VERTICAL ALIGNMENT */
			gap: 20px;
			margin: 25px 0;
		}

		.bottom-actions .action-btn {
			display: flex;
			align-items: center;
			justify-content: center;
		}	

		.win-dot {
			width: 10px;
			height: 10px;
			background: #00ff57;
			border-radius: 50%;
			margin-left: 6px;
		}

		.match-inner {
			background: #101010;
			border-radius: 10px;
			overflow: hidden;
			/* remove padding ‚Äî padding shifts lines! */
		}

		.svg_conn {
			position: absolute;
			inset: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 10;
			/* üî• VERY IMPORTANT */
			overflow: visible;
		}

		.svg_conn path {
			stroke: #ffffff;
			stroke-width: 1.6;
			fill: none;
			stroke-opacity: 0.5;
		}
		
		.bracket-container {
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    flex-shrink: 0;
    white-space: nowrap;
  }
  .round {
    flex: 0 0 auto; /* prevents shrinking / jumping */
  }
		.bracket-wrapper {
    flex-shrink: 0;
    overflow: hidden;
  }
		
		/* ================= FOOTER ================= */
		.site-footer {
			 position: relative;
		  width: 100%;
		  margin-top: 40px;
		  padding: 28px 16px 34px;
		
		  background:
		    linear-gradient(
		      to bottom,
		      rgba(11,15,20,0) 0%,
		      rgba(11,15,20,0.85) 20%,
		      rgba(11,15,20,0.95) 100%
		    );
		  text-align: center;
		  position: relative;
		}
		/* Glow divider */
		.site-footer::before {
		  content: "";
		  position: absolute;
		  top: -24px;
		  left: 50%;
		  transform: translateX(-50%);
		  width: 80%;
		  height: 1px;
		  background: linear-gradient(
		    to right,
		    transparent,
		    rgba(255,255,255,0.12),
		    transparent
		  );
		}
		
		/* Brand highlight */
		.footer-title .brand {
		  color: #4ade80;
		  font-weight: 600;
		  text-shadow: 0 0 10px rgba(74, 222, 128, 0.6);
		}
		
		/* Footer love line */
		.footer-love {
		  margin-top: 14px;
		  font-size: 12px;
		  opacity: 0.6;
		}
		.footer-inner {
		  max-width: 1100px;
		  margin: 0 auto;
		}
		
		.footer-title {
		  font-size: 13px;
		  font-weight: 600;
		  opacity: 0.9;
		  margin-bottom: 6px;
		}
		
		.footer-desc {
		  font-size: 12px;
		  opacity: 0.7;
		  line-height: 1.5;
		}
		
		/* Mobile spacing */
		@media (max-width: 600px) {
		  .footer-desc {
		    font-size: 11px;
		  }
		}
		
		/* ===== V10 NAV LAYOUT ===== */
		.app-layout{
		  display:flex;
		  min-height:100vh;
		}
		
		.side-nav{
		  width:260px;
		  flex:0 0 260px;
		  background: linear-gradient(180deg, rgba(10,30,25,.95), rgba(5,10,20,.95));
		  border-right: 1px solid rgba(255,255,255,.06);
		}
		
		.main-content{
		  flex:1;
		  min-width:0;
		}
		
		/* hamburger button */
		.nav-toggle{
		  display:none;
		  position: fixed;
		  top: 10px;
		  left: 10px;
		  z-index: 5000;
		  border: 1px solid rgba(255,255,255,.12);
		  background: rgba(0,0,0,.45);
		  color:#fff;
		  padding:10px 12px;
		  border-radius: 12px;
		  backdrop-filter: blur(10px);
		}
		
		/* overlay */
		.nav-overlay{
		  display:none;
		}

  /* ===== MOBILE: turn sidebar into a drawer ===== */
  @media (max-width: 900px){
    .nav-toggle{ display:block; }

    .side-nav{
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      transform: translateX(-110%);
      transition: transform .25s ease;
      z-index: 4500;
      box-shadow: 0 20px 80px rgba(0,0,0,.7);
  }

  .app-layout.nav-open .side-nav{
    transform: translateX(0);
  }

  .nav-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.55);
    z-index: 4400;
    display:none;
  }

  .app-layout.nav-open .nav-overlay{
    display:block;
  }

  /* main content should use full width */
  .main-content{
    width:100%;
  }
}
/* ===== NAV UPGRADE (PREVIEW STYLE) ===== */
.side-nav{
  padding: 14px 10px;
  background:
    radial-gradient(1200px 500px at 20% 0%, rgba(0,255,170,.12), transparent 60%),
    linear-gradient(180deg, rgba(10,12,18,.92), rgba(5,7,12,.92));
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-right: 1px solid rgba(255,255,255,.08);
}

.brand{
  padding: 14px 12px;
  margin: 6px 6px 10px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.03);
}

.brand-left{
  display:flex;
  align-items:center;
  gap: 12px;
}

.logo{
  width: 44px;
  height: 44px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius: 14px;
  background: linear-gradient(135deg, rgba(0,255,170,.25), rgba(255,255,255,.06));
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
}

.brand-text{ line-height: 1.05; }
.brand-name{
  font-weight: 900;
  letter-spacing: .16em;
  font-size: 14px;
}
.brand-sub{
  opacity: .65;
  font-size: 12px;
  margin-top: 4px;
}

.nav-section-label{
  margin: 10px 12px 6px;
  font-size: 11px;
  letter-spacing: .18em;
  opacity: .55;
}

.nav-item{
  width: calc(100% - 12px);
  margin: 7px 6px;
  padding: 12px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.02);
  color: rgba(255,255,255,.92);
  cursor: pointer;

  display:flex;
  align-items:center;
  gap: 12px;

  transition: transform .15s ease, background .15s ease, border-color .15s ease;
}

.nav-item:hover{
  transform: translateX(2px);
  background: rgba(255,255,255,.05);
  border-color: rgba(255,255,255,.14);
}

.nav-item .nav-ico{
  width: 34px;
  height: 34px;
  border-radius: 12px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(255,255,255,.08);
}

.nav-item .nav-text{
  font-weight: 700;
  font-size: 14px;
}

.nav-item.active{
  background: linear-gradient(135deg, rgba(0,255,170,.18), rgba(255,255,255,.04));
  border-color: rgba(0,255,170,.25);
  box-shadow: 0 12px 30px rgba(0,0,0,.35);
  position: relative;
}

.nav-item.active::before{
  content:"";
  position:absolute;
  left: -6px;
  top: 50%;
  transform: translateY(-50%);
  width: 4px;
  height: 22px;
  border-radius: 999px;
  background: rgba(0,255,170,.75);
}

.nav-footer{
  margin: 14px 12px 8px;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.02);
  font-size: 12px;
  opacity: .7;
}

/* Make hamburger match the new style */
.nav-toggle{
  width: 46px;
  height: 46px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 12px 26px rgba(0,0,0,.45);
}
/* Make header-row a true centered layout */
#scoreboardView .header-row{
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px 16px;
}

/* Title stays dead-center */
#scoreboardView .header-row h1{
  margin: 0;
  text-align: center;
}

/* Hamburger stays top-left but doesn't affect center */
.nav-toggle{
  left: 16px;
  top: 16px;
}

#fixturesView .header-row button { 
  display: none !important; 
}
/* ===== HOME VIEW UI ===== */
.home-grid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 14px;
  margin-top: 14px;
}
.home-card{
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 14px;
  padding: 16px;
  box-shadow: 0 14px 50px rgba(0,0,0,0.55);
  cursor: pointer;
}
.home-card.disabled{
  opacity:.5;
  cursor:not-allowed;
}
.home-emoji{ font-size:26px; margin-bottom:10px; }
.home-title{
  font-family:'Orbitron',sans-serif;
  color:var(--accent);
  font-size:16px;
  margin-bottom:6px;
}
.home-sub{
  color:#cfd2d9;
  font-size:13px;
}
.home-cta{
  margin-top:12px;
  display:inline-block;
  padding:8px 12px;
  border-radius:10px;
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.08);
  font-weight:700;
}

@media(max-width:900px){
  .home-grid{ grid-template-columns:1fr; }
}
/* ===== NAV TEXT CONSISTENCY FIX ===== */

/* Force same font everywhere in nav */
.side-nav,
.side-nav * {
  font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif !important;
}

/* Nav item base */
.side-nav .nav-item {
  height: 56px;
  padding: 0 16px;
  display: flex;
  align-items: center;
  gap: 14px;

  font-size: 15px;          /* SAME SIZE */
  font-weight: 600;         /* SAME WEIGHT */
  letter-spacing: 0.2px;

  color: rgba(255,255,255,0.92);
}

/* Icon container (emoji/icon circle) */
.side-nav .nav-item .nav-ico,
.side-nav .nav-item span:first-child {
  width: 36px;
  height: 36px;
  min-width: 36px;

  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 18px;          /* SAME ICON SIZE */
}

/* Text label */
.side-nav .nav-item .nav-text,
.side-nav .nav-item span:last-child {
  font-size: 15px;          /* SAME TEXT SIZE */
  font-weight: 600;
  line-height: 1;
}

/* Active state ‚Äî same size, no jump */
.side-nav .nav-item.active {
  font-size: 15px;
  font-weight: 600;
}

/* Section label (MAIN) */
.side-nav .nav-section-label {
  font-size: 11px;
  letter-spacing: 0.18em;
  font-weight: 700;
}

/* ===== Premium Settings UI ===== */
.settings-wrap{
  max-width: 520px;
  margin: 18px auto 60px;
  padding: 0 16px;
}

.settings-head{
  display:flex;
  align-items:center;
  gap:14px;
  padding: 14px 16px;
  border-radius: 18px;
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: 0 12px 45px rgba(0,0,0,.55);
  backdrop-filter: blur(12px);
}

.settings-icon{
  width: 54px;
  height: 54px;
  display:grid;
  place-items:center;
  border-radius: 16px;
  background: radial-gradient(circle at 30% 20%, rgba(255,255,255,.12), rgba(255,255,255,.03));
  border: 1px solid rgba(255,255,255,.10);
  font-size: 22px;
}

.settings-title{
  font-size: 28px;
  font-weight: 800;
  letter-spacing: .5px;
  color: #f6c34a; /* keeps your gold vibe */
  text-shadow: 0 10px 35px rgba(0,0,0,.8);
}

.settings-sub{
  margin-top: 2px;
  font-size: 13px;
  opacity: .78;
}

.settings-card{
  margin-top: 14px;
  border-radius: 18px;
  background: rgba(255,255,255,.035);
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: 0 18px 65px rgba(0,0,0,.55);
  overflow:hidden;
}

.setting-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding: 16px 16px;
}

.setting-left{ display:flex; flex-direction:column; gap:4px; }

.setting-label{
  font-size: 16px;
  font-weight: 700;
}

.setting-desc{
  font-size: 12px;
  opacity: .72;
}

.setting-divider{
  height:1px;
  background: rgba(255,255,255,.06);
  margin: 0 16px;
}

.settings-foot{
  margin-top: 14px;
  font-size: 12px;
  opacity: .55;
  text-align:center;
}

/* nicer switch */
.switch{ position: relative; display:inline-block; width: 56px; height: 30px; }
.switch input{ opacity:0; width:0; height:0; }
.slider{
  position:absolute; cursor:pointer; inset:0;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.10);
  transition:.2s;
  border-radius: 999px;
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.25);
}
.slider:before{
  position:absolute; content:"";
  height: 24px; width: 24px; left: 3px; top: 2.5px;
  background: rgba(255,255,255,.92);
  border-radius: 999px;
  transition:.2s;
  box-shadow: 0 6px 18px rgba(0,0,0,.55);
}
.switch input:checked + .slider{
  background: rgba(34,197,94,.25);
  border-color: rgba(34,197,94,.35);
}
.switch input:checked + .slider:before{ transform: translateX(26px); }

/* optional: makes settings feel centered on tiny screens */
@media (max-width: 480px){
  .settings-title{ font-size: 24px; }
}
/* Prevent connector animation flicker when switching rounds */
#fixturesView.no-conn-anim .svg_conn path{
  animation: none !important;
  stroke-dasharray: none !important;
  stroke-dashoffset: 0 !important;
}

/* Optional: smoother feel for round nav */
.round-nav button{
  -webkit-tap-highlight-color: transparent;
}

/* ===== FIX: stop connector flicker/animation on redraw ===== */
#bracketConnections,
.svg_conn {
  will-change: transform;
  transform: translateZ(0);
}

.svg_conn path {
  animation: none !important;
  transition: none !important;
}

.page-title{
  display:flex;
  align-items:center;
  gap:10px;
  margin:auto;
  color:#f5d36a;
}

.title-ico{
  width:30px;
  height:30px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:10px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);
}

.title-ico .ico{
  width:18px;
  height:18px;
}
#roundIndicator {
  display: none !important;
}

/* ===== FIX: SCORE COLUMN PERFECT ALIGNMENT (no HTML changes) ===== */

/* each player row */
.match-row{
  position: relative;
  display: flex;
  align-items: center;
  gap: 6px;

  /* reserve space on the RIGHT for winner dot so score never shifts */
  padding: 10px 32px 10px 10px;
}

/* separator line between p1 and p2 */
.match-row + .match-row{
  border-top: 1px solid rgba(255,255,255,.14);
}

/* name should shrink, score stays fixed */
.name{
  flex: 1;
  min-width: 0;
}

/* fixed-width score column = perfect vertical alignment */
.score-set{
  display: flex;
  justify-content: flex-end;
  width: 86px;                 /* lock the column width */
  gap: 6px;
  font-variant-numeric: tabular-nums; /* equal-width digits */
}

/* each game score same width so columns line up */
.score-set span{
  display: inline-block;
  width: 22px;
  text-align: right;
}

/* winner dot must NOT affect layout */
.winner-dot{
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);

  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: rgba(37, 211, 102, .7); /* softer green */
}

/* Lock score area width so ALL rows share same right edge */
.score-set{
  min-width: 84px !important;     /* <-- try 84 to 104 depending on your font */
  width: 90px !important;
  justify-content: flex-end;
  font-variant-numeric: tabular-nums;  /* makes numbers same width */
}

/* Give EACH score a fixed slot so 8/15/21 align vertically */
.score-set span,
.score-set .win-score,
.score-set .lose-score{
  display: inline-block;
  width: 20px;         /* each score column width */
  text-align: right;   /* align digits to the right like BWF */
}

/* winner dot should NOT affect alignment */
.winner-dot{
  flex: 0 0 auto;
}

.match{
  width: 280px;
  min-width: 280px;
}
/* ===== FIX: remove ‚Äúfaded bottom‚Äù look on match card ===== */
.match{
  background: #101010;          /* keep solid */
  height: auto;                  /* let content define height */
  min-height: 120px;             /* keeps your original feel */
}

.match-actions{
  background: #101010;           /* SAME as card (kills fade) */
  border-top: 1px solid rgba(255,255,255,.10); /* softer separator */
  border-radius: 0 0 10px 10px;
}

/* ===== Player inputs: portrait = vertical, landscape/desktop = horizontal ===== */
.player-grid{
  display: grid;
  grid-template-columns: 1fr;     /* ‚úÖ default: phone portrait = vertical */
  gap: 10px;
}

/* ‚úÖ phone/tablet landscape OR any wide screen: use 2 columns */
@media (orientation: landscape), (min-width: 900px){
  .player-grid{
    grid-template-columns: repeat(2, 1fr);
  }
}

/* ===== HOME PAGE V1 ===== */
.home-hero{
  display:grid;
  grid-template-columns: 1.2fr .8fr;
  gap: 18px;
  padding: 18px;
  border-radius: 18px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 18px 45px rgba(0,0,0,0.5);
}

.home-kicker{ font-size: 14px; opacity:.85; letter-spacing:.06em; }
.gold{ color: #f2c14e; }

.home-hero-title{
  margin: 10px 0 8px;
  font-size: 30px;
  line-height: 1.15;
  font-weight: 900;
}

.home-hero-sub{ margin: 0 0 14px; opacity:.85; }

.home-hero-actions{ display:flex; gap: 12px; flex-wrap: wrap; margin: 10px 0 14px; }

.home-btn{
  border: 0;
  border-radius: 14px;
  padding: 14px 16px;
  font-weight: 800;
  cursor: pointer;
  box-shadow: 0 12px 28px rgba(0,0,0,.35);
}
.home-btn-primary{ background: #f2c14e; color:#111; }
.home-btn-secondary{ background: rgba(255,255,255,0.08); color:#fff; border:1px solid rgba(255,255,255,0.10); }

.home-badges{ display:flex; gap:10px; flex-wrap: wrap; margin-top: 10px; }
.home-badge{
  padding: 8px 10px;
  border-radius: 999px;
  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.08);
  font-size: 13px;
  opacity:.92;
}

.home-mock{
  border-radius: 18px;
  overflow:hidden;
  border: 1px solid rgba(255,255,255,0.08);
  background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.25));
}
.mock-top{
  display:flex; align-items:center; gap:8px;
  padding: 10px 12px;
  background: rgba(0,0,0,.35);
}
.mock-dot{ width:10px; height:10px; border-radius:50%; background: rgba(255,255,255,.20); }
.mock-title{ margin-left:auto; opacity:.7; font-size: 12px; }
.mock-body{ padding: 14px; }
.mock-line{ height: 10px; border-radius: 999px; background: rgba(255,255,255,.10); margin-bottom: 10px; }
.mock-line.w80{ width: 80%; }
.mock-line.w60{ width: 60%; }

.mock-grid{ display:grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 12px 0; }
.mock-card{ height: 46px; border-radius: 14px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); }

.mock-bracket{ position: relative; height: 90px; margin-top: 10px; }
.mock-node{ width: 42%; height: 14px; border-radius: 999px; background: rgba(255,255,255,.10); margin: 10px 0; }
.mock-conn{
  position:absolute; right: 6px; top: 18px;
  width: 42%; height: 52px;
  border-right: 2px solid rgba(242,193,78,.55);
  border-top: 2px solid rgba(242,193,78,.55);
  border-bottom: 2px solid rgba(242,193,78,.55);
  border-radius: 10px;
  opacity:.9;
}
.mock-conn:nth-child(5){ top: 38px; height: 32px; opacity:.7; }

.home-section{ margin-top: 18px; padding: 0 6px; }
.home-section-title{ margin: 0; font-size: 22px; font-weight: 900; }
.home-section-sub{ margin: 6px 0 14px; opacity:.75; }

.how-grid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}
.how-card{
  padding: 14px;
  border-radius: 16px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
}
.how-num{
  width: 34px; height: 34px; border-radius: 12px;
  display:flex; align-items:center; justify-content:center;
  background: rgba(242,193,78,.18);
  border: 1px solid rgba(242,193,78,.35);
  color: #f2c14e;
  font-weight: 900;
  margin-bottom: 10px;
}
.how-title{ font-weight: 900; margin-bottom: 6px; }
.how-text{ opacity:.8; font-size: 14px; }

.pricing-grid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}
.price-card{
  position: relative;
  padding: 14px;
  border-radius: 16px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
}
.price-card.featured{
  border: 1px solid rgba(242,193,78,.40);
  box-shadow: 0 20px 55px rgba(242,193,78,.10);
}
.price-chip{
  position:absolute;
  top: 12px; right: 12px;
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(242,193,78,.18);
  border: 1px solid rgba(242,193,78,.35);
  color: #f2c14e;
  font-weight: 900;
}
.price-name{ font-weight: 900; opacity:.9; }
.price-amt{ font-size: 28px; font-weight: 900; margin: 8px 0 2px; }
.price-note{ opacity:.7; margin-bottom: 10px; }
.price-list{ margin: 0 0 12px 16px; opacity:.85; }
.price-list li{ margin: 6px 0; }

.premium-how{
  margin-top: 12px;
  padding: 14px;
  border-radius: 16px;
  background: rgba(0,0,0,0.28);
  border: 1px solid rgba(255,255,255,0.08);
}
.premium-how-title{ font-weight: 900; margin-bottom: 6px; }
.premium-how-text{ opacity:.8; }

.faq{
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.08);
}
.faq-q{
  width: 100%;
  text-align:left;
  padding: 14px 14px;
  background: rgba(255,255,255,0.04);
  border: 0;
  color: #fff;
  font-weight: 900;
  display:flex;
  justify-content: space-between;
  align-items:center;
}
.faq-a{
  display:none;
  padding: 12px 14px;
  background: rgba(0,0,0,0.22);
  opacity:.9;
  border-top: 1px solid rgba(255,255,255,0.08);
}
.faq-q.open + .faq-a{ display:block; }
.faq-plus{ opacity:.7; font-size: 18px; }

.modal-backdrop{
  position: fixed;
  inset: 0;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,0.65);
  z-index: 99999;
}

/* FIX: allow .hidden to actually hide the premium modal */
.modal-backdrop.hidden{
  display: none !important;
}
.modal{
  width: min(520px, 92vw);
  border-radius: 18px;
  padding: 16px;
  background: rgba(15,15,15,0.96);
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: 0 28px 70px rgba(0,0,0,.65);
}
.modal-title{ font-size: 20px; font-weight: 900; margin-bottom: 6px; }
.modal-sub{ opacity:.8; margin-bottom: 14px; }
.modal-row{ display:flex; gap: 10px; flex-wrap: wrap; }
.modal-note{ opacity:.7; font-size: 13px; margin-top: 12px; }

@media (max-width: 980px){
  .home-hero{ grid-template-columns: 1fr; }
  .how-grid{ grid-template-columns: repeat(2, 1fr); }
  .pricing-grid{ grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 520px){
  .how-grid{ grid-template-columns: 1fr; }
  .pricing-grid{ grid-template-columns: 1fr; }
  .home-hero-title{ font-size: 26px; }
}

/* When modal is open, stop background scroll */
body.modal-open{
  overflow: hidden;
}

/* Selected plan highlight */
.price-card.is-selected{
  border: 1px solid rgba(242,193,78,.55) !important;
  box-shadow: 0 22px 70px rgba(242,193,78,.12);
}

/* ===== HOME PREVIEW (make skeleton visible) ===== */
.home-mock{
  background: radial-gradient(circle at 30% 0%, rgba(255,255,255,.06), transparent 45%),
              linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: 0 18px 60px rgba(0,0,0,.55);
}

.mock-body{
  opacity: 1;                 /* ensure not faded */
  filter: none;
}

.mock-line,
.mock-card,
.mock-node{
  background: rgba(255,255,255,.10);   /* stronger contrast */
  border: 1px solid rgba(255,255,255,.08);
}

.mock-line{
  height: 10px;
  border-radius: 999px;
}

.mock-card{
  border-radius: 14px;
  min-height: 54px;
}

.mock-bracket{
  margin-top: 14px;
  padding-top: 10px;
  border-top: 1px solid rgba(255,255,255,.08);
}

.mock-conn{
  background: linear-gradient(90deg, rgba(255,202,40,.35), rgba(255,202,40,.10));
  height: 2px;
  border-radius: 99px;
  opacity: .8;
}

/* shimmer animation so it feels like a real preview */
.home-mock .mock-line,
.home-mock .mock-card{
  position: relative;
  overflow: hidden;
}

.home-mock .mock-line::after,
.home-mock .mock-card::after{
  content: "";
  position: absolute;
  inset: 0;
  transform: translateX(-120%);
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
  animation: mockShimmer 1.8s ease-in-out infinite;
}

@keyframes mockShimmer{
  0%   { transform: translateX(-120%); }
  100% { transform: translateX(120%); }
}

.mock-mini{ display:flex; gap:8px; margin:10px 0 12px; }
.mock-tag{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  background: rgba(0,0,0,.35);
  border: 1px solid rgba(255,255,255,.10);
  color:#fff;
  opacity:.85;
}
</style>
</head>
<body>
<div class="app-layout">

  <!-- ===== LEFT NAV ===== -->
		<aside class="side-nav">
		  <div class="brand">
		    <div class="brand-left">
		      <div class="logo">üè∏</div>
		      <div class="brand-text">
		        <div class="brand-name">DEJU</div>
		        <div class="brand-sub">Badminton</div>
		      </div>
		    </div>
		  </div>
		
		  <div class="nav-section-label">MAIN</div>
				<button class="nav-item active" onclick="showHome()">
				  <span class="nav-ico">
				    <svg viewBox="0 0 24 24" class="ico">
				      <path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1V10.5z"
				            fill="none" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round"/>
				    </svg>
				  </span>
				  <span class="nav-text">Home</span>
				</button>
				
				<button class="nav-item" onclick="showScoreboard()">
				  <span class="nav-ico">
								<svg viewBox="0 0 24 24" class="ico" aria-hidden="true">
								  <!-- outer board -->
								  <rect x="2.5" y="5"
								        width="19" height="14"
								        rx="2.5"
								        fill="none"
								        stroke="currentColor"
								        stroke-width="1.3"/>
								
								  <!-- left score box -->
								  <rect x="4.2" y="7.5"
								        width="6" height="6"
								        rx="1"
								        fill="none"
								        stroke="currentColor"
								        stroke-width="1.3"/>
								
								  <!-- right score box -->
								  <rect x="13.8" y="7.5"
								        width="6" height="6"
								        rx="1"
								        fill="none"
								        stroke="currentColor"
								        stroke-width="1.3"/>
								
								  <!-- scores -->
								  <text x="7.2" y="11.8"
								        text-anchor="middle"
								        font-size="4.2"
								        font-weight="600"
								        fill="currentColor">2</text>
								
								  <text x="16.8" y="11.8"
								        text-anchor="middle"
								        font-size="4.2"
								        font-weight="600"
								        fill="currentColor">1</text>
								
								  <!-- VS -->
								  <text x="12" y="16.5"
								        text-anchor="middle"
								        font-size="3.2"
								        font-weight="600"
								        fill="currentColor">VS</text>
								</svg>							
				  </span>
				  <span class="nav-text">Scoreboard</span>
				</button>
				
				<button class="nav-item" onclick="showFixtures()">
				  <span class="nav-ico">
				    <svg viewBox="0 0 24 24" class="ico" aria-hidden="true">
				      <g fill="none" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round">
				        <!-- left nodes -->
				        <rect x="2.5" y="4" width="5" height="3" rx="0.6"></rect>
				        <rect x="2.5" y="8.5" width="5" height="3" rx="0.6"></rect>
				        <rect x="2.5" y="13" width="5" height="3" rx="0.6"></rect>
				        <rect x="2.5" y="17.5" width="5" height="3" rx="0.6"></rect>
				
				        <!-- middle nodes -->
				        <rect x="10.5" y="6" width="5" height="3" rx="0.6"></rect>
				        <rect x="10.5" y="15" width="5" height="3" rx="0.6"></rect>
				
				        <!-- right node -->
				        <rect x="18" y="10.5" width="5" height="3" rx="0.6"></rect>
				
				        <!-- connectors (top pair -> top middle) -->
				        <path d="M7.5 5.5H9.5V7.5H10.5"></path>
				        <path d="M7.5 10H9.5V7.5H10.5"></path>
				
				        <!-- connectors (bottom pair -> bottom middle) -->
				        <path d="M7.5 14.5H9.5V16.5H10.5"></path>
				        <path d="M7.5 19H9.5V16.5H10.5"></path>
				
				        <!-- connectors (middle -> right) -->
				        <path d="M15.5 7.5H17.5V12H18"></path>
				        <path d="M15.5 16.5H17.5V12H18"></path>
				      </g>
				    </svg>
				  </span>				
				  <span class="nav-text">Fixture Brackets</span>
				</button>				
				
				<button class="nav-item" onclick="showSettings()">
				  <span class="nav-ico">
				    <svg viewBox="0 0 24 24" class="ico">
				      <path d="M12 15.2a3.2 3.2 0 1 0 0-6.4 3.2 3.2 0 0 0 0 6.4z"
				            fill="none" stroke="currentColor" stroke-width="1.5"/>
				      <path d="M19.4 13a7.9 7.9 0 0 0 .1-2l2-1.2-2-3.4-2.3.7a7.7 7.7 0 0 0-1.7-1L15 3h-6l-.5 2.1a7.7 7.7 0 0 0-1.7 1l-2.3-.7-2 3.4 2 1.2a7.9 7.9 0 0 0 0 2l-2 1.2 2 3.4 2.3-.7a7.7 7.7 0 0 0 1.7 1L9 21h6l.5-2.1a7.7 7.7 0 0 0 1.7-1l2.3.7 2-3.4-2-1.2z"
				            fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
				    </svg>
				  </span>
				  <span class="nav-text">Settings</span>
				</button>
				<button class="nav-item" onclick="showAccount()">
				  <span class="nav-icon">üë§</span>
				  <span class="nav-text">Account</span>
				</button>			
		  <div class="nav-footer">¬© 2025 Deju Badminton</div>
		</aside> 
		<div id="navOverlay" class="nav-overlay"></div>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="main-content">
		<button id="navToggle" class="nav-toggle" aria-label="Open menu">‚ò∞</button>
  <div class="container" id="app">
		<!-- ===== HOME VIEW ===== -->
		<div id="homeView">
		  <div class="header-row">
						<h1 class="page-title">
						  <span class="title-ico">
						    <svg viewBox="0 0 24 24" class="ico" aria-hidden="true">
						      <path d="M3 11.5L12 4l9 7.5"
						        fill="none"
						        stroke="currentColor"
						        stroke-width="1.3"
						        stroke-linecap="round"
						        stroke-linejoin="round"/>
						      <path d="M5.5 11V20h13V11"
						        fill="none"
						        stroke="currentColor"
						        stroke-width="1.3"
						        stroke-linecap="round"
						        stroke-linejoin="round"/>
						      <path d="M10 20v-6c0-.6.4-1 1-1h2c.6 0 1 .4 1 1v6"
						        fill="none"
						        stroke="currentColor"
						        stroke-width="1.3"
						        stroke-linecap="round"
						        stroke-linejoin="round"/>
						    </svg>
						  </span>
						  Home
						</h1>    
		    <span></span>
		  </div>
		
		<!-- ===== HOME HERO ===== -->
		<section class="home-hero">
		  <div class="home-hero-left">
		    <div class="home-kicker">Run badminton tournaments ‚Äî <span class="gold">Fast & Fair</span></div>
		    <h2 class="home-hero-title">Create brackets, manage matches,<br>and run live scoreboards in minutes.</h2>
		    <p class="home-hero-sub">
		      Designed for clubs, schools, and local tournaments. Works on phone, tablet, and TV.
		    </p>
		
		    <div class="home-hero-actions">
		      <button class="home-btn home-btn-primary" onclick="showFixtures()">üèÜ Create Tournament</button>
		      <button class="home-btn home-btn-secondary" onclick="showScoreboard()">üì∫ Open Live Scoreboard</button>
		    </div>
		
		    <div class="home-badges">
		      <div class="home-badge">‚ö° Instant Brackets</div>
		      <div class="home-badge">üì± Mobile Friendly</div>
		      <div class="home-badge">üñ•Ô∏è TV Mode Ready</div>
		    </div>
		  </div>
		
		  <div class="home-hero-right">
		    <div class="home-mock">
		      <div class="mock-top">
		        <span class="mock-dot"></span><span class="mock-dot"></span><span class="mock-dot"></span>
		        <span class="mock-title">Preview</span>
		      </div>
		      <div class="mock-body">
		        <div class="mock-line w80"></div>
										<div class="mock-mini">
										  <div class="mock-tag">MS</div>
										  <div class="mock-tag">R16</div>
										  <div class="mock-tag">Court 1</div>
										</div>										
		        <div class="mock-line w60"></div>
		        <div class="mock-grid">
		          <div class="mock-card"></div>
		          <div class="mock-card"></div>
		          <div class="mock-card"></div>
		          <div class="mock-card"></div>
		        </div>
		        <div class="mock-bracket">
		          <div class="mock-node"></div><div class="mock-node"></div><div class="mock-node"></div>
		          <div class="mock-conn"></div><div class="mock-conn"></div>
		        </div>
		      </div>
		    </div>
		  </div>
		</section>
		
		<!-- ===== HOW IT WORKS ===== -->
		<section class="home-section">
		  <h3 class="home-section-title">How It Works</h3>
		  <p class="home-section-sub">Run tournaments like a pro in 4 simple steps.</p>
		
		  <div class="how-grid">
		    <div class="how-card">
		      <div class="how-num">1</div>
		      <div class="how-title">Enter Players</div>
		      <div class="how-text">Add players or teams and choose draw size + match type.</div>
		    </div>
		
		    <div class="how-card">
		      <div class="how-num">2</div>
		      <div class="how-title">Generate Bracket</div>
		      <div class="how-text">Instantly create a clean bracket with auto-byes.</div>
		    </div>
		
		    <div class="how-card">
		      <div class="how-num">3</div>
		      <div class="how-title">Play Matches</div>
		      <div class="how-text">Advance winners manually or run live scoring.</div>
		    </div>
		
		    <div class="how-card">
		      <div class="how-num">4</div>
		      <div class="how-title">Display Scoreboard</div>
		      <div class="how-text">Open TV mode for audience-friendly viewing.</div>
		    </div>
		  </div>
		</section>
		
		<!-- ===== PREMIUM ===== -->
		<section class="home-section">
		  <h3 class="home-section-title">Premium</h3>
		  <p class="home-section-sub">Unlock pro tools: save tournaments, exports, TV mode, and more.</p>
		
		  <div class="pricing-grid">
		    <div class="price-card">
		      <div class="price-name">Free</div>
		      <div class="price-amt">$0</div>
		      <div class="price-note">Forever</div>
		      <ul class="price-list">
		        <li>Create brackets</li>
		        <li>Enter players</li>
		        <li>Manual match control</li>
		        <li>Basic scoreboard</li>
		      </ul>
		      <button class="home-btn home-btn-secondary" onclick="showFixtures()">Use Free</button>
		    </div>
		
		    <div class="price-card featured" data-plan="monthly">
		      <div class="price-chip">Best value</div>
		      <div class="price-name">Premium Monthly</div>
		      <div class="price-amt">$4.99</div>
		      <div class="price-note">per month</div>
		      <ul class="price-list">
		        <li>Save & resume tournaments</li>
		        <li>TV / Fullscreen mode</li>
		        <li>Bracket export (PDF / Image)</li>
		        <li>No watermark</li>
		      </ul>
		      <button class="home-btn home-btn-primary" onclick="openPremium('monthly')">Unlock Monthly</button>
		    </div>
		
		    <div class="price-card" data-plan="yearly">
		      <div class="price-name">Premium Yearly</div>
		      <div class="price-amt">$39.99</div>
		      <div class="price-note">per year</div>
		      <ul class="price-list">
		        <li>Everything in Monthly</li>
		        <li>Priority updates</li>
		        <li>Early feature access</li>
		      </ul>
		      <button class="home-btn home-btn-secondary" onclick="openPremium('yearly')">Unlock Yearly</button>
		    </div>
		
		    <div class="price-card" data-plan="lifetime">
		      <div class="price-name">Lifetime</div>
		      <div class="price-amt">$79.99</div>
		      <div class="price-note">one-time</div>
		      <ul class="price-list">
		        <li>Everything in Premium</li>
		        <li>Pay once, keep forever</li>
		        <li>Best for clubs</li>
		      </ul>
		      <button class="home-btn home-btn-secondary" onclick="openPremium('lifetime')">Unlock Lifetime</button>
		    </div>
		  </div>
		
		  <div class="premium-how">
		    <div class="premium-how-title">How Premium works</div>
		    <div class="premium-how-text">
		      Choose a plan ‚Üí checkout ‚Üí Premium unlocks on this device. (We‚Äôll connect real Stripe checkout next.)
		    </div>
		  </div>
		</section>
		
		<!-- ===== FAQ ===== -->
		<section class="home-section">
		  <h3 class="home-section-title">FAQ</h3>
		
		  <div class="faq">
		    <button class="faq-q" onclick="toggleFaq(this)">
		      Do I need Premium to use it?
		      <span class="faq-plus">+</span>
		    </button>
		    <div class="faq-a">No. Free mode lets you generate brackets and run basic scoring.</div>
		
		    <button class="faq-q" onclick="toggleFaq(this)">
		      Does it work offline?
		      <span class="faq-plus">+</span>
		    </button>
		    <div class="faq-a">Yes for most features. Online is only needed for optional external assets/links.</div>
		
		    <button class="faq-q" onclick="toggleFaq(this)">
		      Can I cancel Monthly/Yearly anytime?
		      <span class="faq-plus">+</span>
		    </button>
		    <div class="faq-a">Yes. Monthly/Yearly can be canceled anytime from your payment provider.</div>
		  </div>
		</section>
		
		<!-- ===== PREMIUM MODAL (Demo for now) ===== -->
		<div id="premiumModal" class="modal-backdrop hidden" aria-hidden="true">
		  <div class="modal">
		    <div class="modal-title">Unlock Premium</div>
		    <div class="modal-sub" id="premiumPlanLine">Plan: ‚Äî</div>
		
		    <div class="modal-row">
		      <button class="home-btn home-btn-primary" onclick="enablePremiumDemo()">Enable Premium (Demo)</button>
		      <button class="home-btn home-btn-secondary" onclick="closePremium()">Close</button>
		    </div>
		
		    <div class="modal-note">
		      Demo unlock is for testing UI. When you‚Äôre ready, we‚Äôll replace this with Stripe checkout links.
		    </div>
		  </div>
		</div>
		</div>		
		<!-- ===== SCOREBOARD VIEW ===== -->
		<div id="scoreboardView" class="hidden">
			<div class="header-row">
				<h1>üè∏Badminton Scoreboard</h1>
			</div> <!-- ‚úÖ CLOSE header-row -->

			<div class="board" aria-live="polite">
				<div class="players">
					<!-- P1 -->
					<div class="player" id="player1">
						<button class="flag-btn" id="flagBtn1" title="Change country for player 1" aria-label="Change country for player 1">
							<img id="flagImg1" class="flag-img" src="https://flagcdn.com/w80/us.png" alt="flag" data-country="us">
						</button>
						<div id="name1" class="player-name" contenteditable="true" spellcheck="false">Player 1</div>
						<div id="countryLabel1" class="country-label">United States</div>

						<div class="score-box" role="status" aria-live="polite">
							<div id="score1" class="score">0</div>
						</div>
						<div id="games1" class="games">Games Won: 0</div>

						<div class="controls">
							<button class="btn plus" data-player="1" data-change="1" aria-label="Add point to Player 1">+</button>
							<button class="btn minus" data-player="1" data-change="-1" aria-label="Subtract point from Player 1">‚àí</button>
						</div>						
					</div>

					<!-- P2 -->
					<div class="player" id="player2">
						<button class="flag-btn" id="flagBtn2" title="Change country for player 2" aria-label="Change country for player 2">
							<img id="flagImg2" class="flag-img" src="https://flagcdn.com/w80/us.png" alt="flag" data-country="us">
						</button>
						<div id="name2" class="player-name" contenteditable="true" spellcheck="false">Player 2</div>
						<div id="countryLabel2" class="country-label">United States</div>

						<div class="score-box" role="status" aria-live="polite">
							<div id="score2" class="score">0</div>
						</div>
						<div id="games2" class="games">Games Won: 0</div>

						<div class="controls">
							<button class="btn plus" data-player="2" data-change="1" aria-label="Add point to Player 2">+</button>
							<button class="btn minus" data-player="2" data-change="-1" aria-label="Subtract point from Player 2">‚àí</button>
						</div>
					</div>
				</div>

				<div id="scoreLockBanner" class="lock-banner" style="display:none"></div>
				<button class="reset" id="resetBtn">RESET MATCH</button>
				<div id="winner" class="winnerText" aria-live="polite"></div>

				<!-- History -->
				<div class="history" id="historyBox" aria-live="polite">
					<h3>Match History</h3>
					<ul id="historyList"></ul>
					<button id="clearHistory" class="clear-history">Clear History</button>
				</div>
			</div>
			<footer class="site-footer">
     <div class="footer-inner">
       <div class="footer-title">
         ¬© 2025 <span class="brand">Deju Badminton Scoreboard</span> üè∏
       </div>
       <div class="footer-desc">
         A sleek, interactive tool for badminton scoring and tournaments.<br />
         Real-time points, games tracking, player flags, and full BWF-style fixtures ‚Äî
         built for players, organizers, and spectators.
       </div>

       <div class="footer-love">
         Built with ‚ù§Ô∏è for badminton players
       </div>
     </div>
    </footer>
		</div>

		<!-- ===== FIXTURES VIEW ===== -->
		<div id="fixturesView" class="hidden">
			<div class="header-row">
				<button onclick="showScoreboard()">‚¨Ö Back to Scoreboard</button>
				<h1 style="margin:auto">üèÜTournament Fixture</h1>
				<span></span>
			</div>

			<div class="fixture-shell">
				<div class="fixture-header">
					<!-- LIVE Fixtures Button -->
					<button id="liveFixturesBtn" class="action-btn" style="margin:10px 0; padding:8px 14px; border-radius:6px; background:#1e88e5; color:#fff; font-weight:600;">
						üì° Live Fixtures
					</button>					

					<!-- Step Labels -->
					<div id="stageBefore" class="slabel">Step 1: Enter players ‚Üí Generate</div>
					<div id="stageAfter" class="slabel hidden">Step 2: Play matches ‚Üí advance winners</div>
				</div> <!-- END fixture-header -->

				<!-- Category Dropdown -->
				<div class="cat-wrap">
						<button id="catPill" class="cat-pill" aria-haspopup="true" aria-expanded="false">
						  <span class="cat-pill-inner">
						    <span id="catLabel" class="cat-label">MS</span>
						
						    <!-- BWF-style chevron -->
						    <svg class="cat-chev" viewBox="0 0 24 24" aria-hidden="true">
						      <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="5.0" stroke-linecap="round" stroke-linejoin="round"/>
						    </svg>
						  </span>
						</button>					

						<div id="catMenu" class="cat-menu" role="menu" aria-label="Event types">
									<div class="cat-title">Main Draw</div>

									<div class="cat-item" data-cat="MS">MS</div>
									<div class="cat-item" data-cat="WS">WS</div>
									<div class="cat-item" data-cat="MD">MD</div>
									<div class="cat-item" data-cat="WD">WD</div>
									<div class="cat-item" data-cat="XD">XD</div>
						</div>
				</div>				
				
				<!-- INPUT STAGE -->
				<div id="inputStage" class="input-panel">
					<div class="input-row">
						<div class="slabel">Players</div>
						<select id="playerCount" class="select">
							<option value="32">32 (R32)</option>
							<option value="16">16 (R16)</option>
							<option value="8">8 (R8)</option>
						</select>
						<div class="slabel" style="margin-left:12px">Match Type</div>
						<select id="matchType" class="select">
							<option value="1">Best of 1</option>
							<option value="3" selected>Best of 3</option>
						</select>
					</div>

					<div id="playerGrid" class="player-grid"></div>

					<div class="actions">
						<button id="clearInputsBtn" class="ghost">Clear</button>
						<button id="generateBtn" class="primary">Generate Bracket</button>
					</div>
				</div>

				<!-- BRACKET STAGE -->
				<div id="bracketStage" class="hidden">
					<div class="round-indicator" id="roundIndicator"></div>
					<div id="bracketContainer" class="bracket-canvas">
						<svg id="bracketConnections" class="svg_conn"></svg>
						<div id="roundWrap" class="round-wrap"></div>
					</div>
					<div class="bottom-actions">
						<button id="editPlayersBtn" class="action-btn edit">
							<i class="fa fa-user-edit"></i> Edit Players
						</button>
						<button id="resetBracketBtn" class="action-btn reset">
							<i class="fa fa-undo"></i> Reset
						</button>
					</div>
					<!-- WALKOVER NOTICE -->
					<div id="walkoverNotice" class="walkover-banner hidden">
						<span class="wo-box">WO</span> Walkover
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- ===== SETTINGS VIEW ===== -->
	<div id="settingsView" class="hidden">
	  <div class="settings-wrap">
	    <div class="settings-head">
	      <div class="settings-icon">‚öôÔ∏è</div>
	      <div>
	        <div class="settings-title">Settings</div>
	        <div class="settings-sub">Personalize your scoreboard experience</div>
	      </div>
	    </div>
	
	    <div class="settings-card">
	      <div class="setting-row">
	        <div class="setting-left">
	          <div class="setting-label">Light Mode</div>
	          <div class="setting-desc">Use a brighter theme</div>
	        </div>
	
	        <label class="switch">
	          <input type="checkbox" id="lightToggle">
	          <span class="slider"></span>
	        </label>
	      </div>
	
	      <div class="setting-divider"></div>
	
	      <div class="setting-row">
	        <div class="setting-left">
	          <div class="setting-label">Sounds</div>
	          <div class="setting-desc">Button clicks & match actions</div>
	        </div>
	
	        <label class="switch">
	          <input type="checkbox" id="soundToggle">
	          <span class="slider"></span>
	        </label>
	      </div>
	    </div>
	
	    <div class="settings-foot">¬© 2025 Deju Badminton</div>
	  </div>
	</div>
	<!-- ===== END SETTINGS VIEW ===== -->

	<!-- ===== ACCOUNT VIEW ===== -->
	<div id="accountView" class="view hidden">
	  <div class="header-row">
	    <h1 class="page-title"><span class="title-ico">üë§</span> Account</h1>
	  </div>
	
	  <div class="panel">
	    <div id="authLoggedOut">
	      <h2 class="section-title">Login</h2>
	      <div class="form-row">
	        <label>Email</label>
	        <input id="loginEmail" class="input" type="email" placeholder="you@email.com">
	      </div>
	      <div class="form-row">
	        <label>Password</label>
	        <input id="loginPass" class="input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
	      </div>
	      <button class="btn primary" onclick="loginLocal()">Login</button>
	
	      <div style="height:14px"></div>
	
	      <h2 class="section-title">Create account</h2>
	      <div class="form-row">
	        <label>Email</label>
	        <input id="regEmail" class="input" type="email" placeholder="you@email.com">
	      </div>
	      <div class="form-row">
	        <label>Password</label>
	        <input id="regPass" class="input" type="password" placeholder="Create a password">
	      </div>
	      <button class="btn" onclick="registerLocal()">Create Account</button>
	
	      <p class="hint">For now this is a local demo account. Next we‚Äôll connect real login + Stripe.</p>
	    </div>
	
	    <div id="authLoggedIn" class="hidden">
	      <h2 class="section-title">Your account</h2>
	      <p id="accountEmail" class="hint"></p>
	
	      <div class="row">
	        <button class="btn primary" onclick="openManageSubscription()">Manage Subscription</button>
	        <button class="btn" onclick="logout()">Logout</button>
	      </div>
	
	      <div style="height:14px"></div>
	
	      <h3 class="section-title">Data</h3>
	      <div class="row">
	        <button class="btn" onclick="exportMyData()">Export</button>
	        <button class="btn" onclick="clearMyData()">Clear my data</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<!-- FLAG MODAL -->
	<div id="flagModalBackdrop" class="flag-modal-backdrop" role="dialog" aria-hidden="true">
		<div class="flag-modal" aria-modal="true">
			<h4>Select a flag</h4>
			<div class="flag-grid" id="flagGrid"></div>
			<div style="text-align:center;margin-top:8px"><button id="closeFlagModal" class="close-btn" style="padding:8px 12px">CLOSE</button></div>
		</div>
	</div>

	<!-- WINNER OVERLAY -->
	<div id="overlay" class="overlay" aria-hidden="true">
		<canvas id="confettiCanvas"></canvas>
		<div class="overlay-inner" role="dialog" aria-modal="true">
			<img id="winnerFlagBig" class="winner-flag" src="" alt="Winner Flag">
			<div id="winnerTitle" class="winner-title"></div>
			<button id="closeWinner" class="close-btn">CLOSE</button>
		</div>
	</div>

	<!-- MANUAL SCORE MODAL -->
	<div id="manualScoreBackdrop" class="manual-score-modal">
		<div class="manual-form">
			<h4>Enter Match Scores</h4>
			<div id="gameInputs"></div>
			<div class="actions">
				<button id="submitManualScore" class="primary">Submit</button>
				<button id="closeManualScore" class="ghost">Cancel</button>
			</div>
		</div>
	</div>

	<script>
	 // Wait for DOM to load
		document.addEventListener('DOMContentLoaded', function() {

			/* =================== UTIL & MOBILE TWEAKS =================== */
			(function preventZoomSafe() {
     document.addEventListener('gesturestart', e => e.preventDefault());

     // Only prevent double-tap zoom on buttons
    document.querySelectorAll('button').forEach(btn => {
       let lastTap = 0;
       btn.addEventListener('touchend', e => {
         const now = Date.now();
         if (now - lastTap < 300) e.preventDefault();
         lastTap = now;
       }, { passive: false });
     });
   })();

			function vibrateShort() { if (navigator.vibrate) navigator.vibrate(35); }

			function attachFast(el, fn) {
			  if (!el) return;
			
			  let last = 0;
			  const MIN = 80; // slightly higher for mobile stability
			  let ignoreClickUntil = 0;
			
			  function fire(e) {
			    const now = performance.now();
			    if (now - last < MIN) return;
			    last = now;
			    fn(e);
			  }
			
			  if (window.PointerEvent) {
			    el.addEventListener('pointerdown', e => {
			      if (e.pointerType === 'mouse' && e.button !== 0) return;
			      e.preventDefault();
			      ignoreClickUntil = performance.now() + 700;
			      fire(e);
			    }, { passive: false });
			  } else {
			    el.addEventListener('touchstart', e => {
			      e.preventDefault();
			      ignoreClickUntil = performance.now() + 700;
			      fire(e);
			    }, { passive: false });
			  }
			
			  el.addEventListener('click', e => {
			    if (performance.now() < ignoreClickUntil) return;
			    e.preventDefault();
			    fire(e);
			  }, { passive: false });
			}			

			function escapeHtml(s) { return String(s).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m]); }

			/* =================== DOM REFS (SAFE) =================== */
			const name1 = document.getElementById('name1');
			const name2 = document.getElementById('name2');
			const flagImg1 = document.getElementById('flagImg1');
			const flagImg2 = document.getElementById('flagImg2');
			const countryLabel1 = document.getElementById('countryLabel1');
			const countryLabel2 = document.getElementById('countryLabel2');
			const score1El = document.getElementById('score1');
			const score2El = document.getElementById('score2');
			const games1El = document.getElementById('games1');
			const games2El = document.getElementById('games2');
			const winnerEl = document.getElementById('winner');
			const historyList = document.getElementById('historyList');
			const clearHistory = document.getElementById('clearHistory');
			const scoreLockBanner = document.getElementById('scoreLockBanner');

			let currentMatchType = 3; // Default

			/* =================== SCOREBOARD STATE =================== */
			const FIXED_COUNTRIES = [{ code: 'us' }, { code: 'ca' }, { code: 'th' }, { code: 'cn' }, { code: 'sg' }, { code: 'de' }, { code: 'dk' }, { code: 'jp' }, { code: 'np' }, { code: 'gb' }, { code: 'fr' }, { code: 'in' }, { code: 'hk' }, { code: 'id' }, { code: 'my' }, { code: 'kr' }, { code: 'tw' }, { code: 'au' }, { code: 'es' }, { code: 'it' }];

			let score1 = 0,
				score2 = 0,
				games1 = 0,
				games2 = 0;
			let currentGameScores = [];
			let autoResetTimer = null;
			const HISTORY_KEY = 'badminton_score_history_pf_v3';

			let lockedMatch = null;

			function updateDisplays() {
				score1El.textContent = score1;
				score2El.textContent = score2;
				games1El.textContent = 'Games Won: ' + games1;
				games2El.textContent = 'Games Won: ' + games2;
			}

			function getPlayerName(n) { return (n === 1 ? name1 : name2).textContent.trim() || 'Player ' + n; }

			function getPlayerCountry(n) { return (n === 1 ? flagImg1 : flagImg2).dataset.country || 'us'; }

			function addPoint(n) {
				const mt = currentMatchType;
				if (games1 >= Math.ceil(mt / 2) || games2 >= Math.ceil(mt / 2)) return;
				if (n === 1) score1++;
				else score2++;
				updateDisplays();
				checkGame(mt);
			}

			function subtractPoint(n) {
				if (n === 1 && score1 > 0) score1--;
				if (n === 2 && score2 > 0) score2--;
				updateDisplays();
			}

			function checkGame(matchType) {
				if ((score1 >= 21 || score2 >= 21) && Math.abs(score1 - score2) >= 2) finishGame(matchType);
				else if (score1 === 30 || score2 === 30) finishGame(matchType);
			}

			function finishGame(matchType) {
				currentGameScores.push({ p1: score1, p2: score2 });
				if (score1 > score2) {
					games1++;
					showGameToast(getPlayerName(1) + ' wins the game');
				} else {
					games2++;
					showGameToast(getPlayerName(2) + ' wins the game');
				}
				score1 = 0;
				score2 = 0;
				updateDisplays();
				checkMatchWinner(matchType);
			}

			function checkMatchWinner(matchType) {
				const need = Math.ceil(matchType / 2);
				if (games1 === need || games2 === need) {
					const winnerPlayer = games1 > games2 ? 1 : 2;
					const entry = {
						winnerPlayer,
						winnerName: getPlayerName(winnerPlayer),
						winnerCode: getPlayerCountry(winnerPlayer),
						loserName: getPlayerName(winnerPlayer === 1 ? 2 : 1),
						loserCode: getPlayerCountry(winnerPlayer === 1 ? 2 : 1),
						games: currentGameScores.slice(),
						time: Date.now()
					};
					addMatchHistory(entry);
					winnerEl.textContent = 'Winner: ' + entry.winnerName + ' wins the match!';
					showWinnerOverlay(entry.winnerName + ' wins the match!', entry.winnerCode);
					vibrateShort();

					if (lockedMatch) {
						applyScoreToBracket(lockedMatch, entry);
						lockedMatch = null;
						scoreLockBanner.style.display = 'none';
					}

					if (autoResetTimer) clearTimeout(autoResetTimer);
					autoResetTimer = setTimeout(() => {
						resetForNewMatch();
					}, 2000);
				}
			}

			function resetForNewMatch() {
			  score1 = 0;
			  score2 = 0;
			  games1 = 0;
			  games2 = 0;
			  currentGameScores = [];
			  updateDisplays();
			  winnerEl.textContent = '';
			  hideOverlay();
			
			  // ‚≠ê NEW FIX ‚Äî CLEAR SCOREBOARD PLAYERS AFTER MATCH FINISH
			  if (lockedMatch !== null) {
			    name1.textContent = "Player 1";
			    name2.textContent = "Player 2";
			    setCountry(1, "us");
			    setCountry(2, "us");
			    lockedMatch = null;
			    scoreLockBanner.style.display = "none";
			  }
			}			

			function showGameToast(msg) {
				const t = document.createElement('div');
				t.textContent = msg;
				Object.assign(t.style, { position: 'fixed', left: '50%', top: '18px', transform: 'translateX(-50%)', background: '#111', color: '#fff', padding: '10px 16px', border: '2px solid #00e676', borderRadius: '8px', zIndex: 9999 });
				document.body.appendChild(t);
				setTimeout(() => t.remove(), 1200);
			}

			/* =================== HISTORY =================== */
			function loadHistory() { try { const r = localStorage.getItem(HISTORY_KEY); return r ? JSON.parse(r) : []; } catch (e) { return []; } }

			function saveHistory(l) { try { localStorage.setItem(HISTORY_KEY, JSON.stringify(l)); } catch (e) {} }

			function renderHistory() {
				const list = loadHistory();
				historyList.innerHTML = '';
				if (!list.length) {
					clearHistory.style.display = 'none';
					historyList.innerHTML = '<li style="color:#777">No matches yet</li>';
					return;
				}
				clearHistory.style.display = 'inline-block';
				list.forEach((item, idx) => {
					const gameStr = (item.games || []).map((g, i) => `Game ${i+1}: ${g.p1} - ${g.p2}`).join(' | ');
					const timeStr = new Date(item.time).toLocaleString();
					const li = document.createElement('li');
					li.innerHTML = `<strong>Match ${list.length-idx}:</strong> <strong>${escapeHtml(item.winnerName)}</strong> defeated ${escapeHtml(item.loserName)}<br><small>${gameStr} | ${timeStr}</small>`;
					historyList.appendChild(li);
				});
			}

			function addMatchHistory(entry) {
				const l = loadHistory();
				l.unshift(entry);
				if (l.length > 20) l.pop();
				saveHistory(l);
				renderHistory();
			}

			/* =================== WINNER OVERLAY & FIREWORKS =================== */
			const overlay = document.getElementById('overlay');
			const confettiCanvas = document.getElementById('confettiCanvas');
			const ctx = confettiCanvas.getContext ? confettiCanvas.getContext('2d') : null;

			function resizeCanvas() {
				if (confettiCanvas) {
					confettiCanvas.width = window.innerWidth;
					confettiCanvas.height = window.innerHeight;
				}
			}
			window.addEventListener('resize', resizeCanvas);
			resizeCanvas();
			let fireworksParticles = [];

			function createBurst(cx, cy, count) {
				const colors = ['#ff3864', '#ffd400', '#32d74b', '#4cc3ff', '#ff7b00', '#b784ff'];
				for (let i = 0; i < count; i++) {
					const speed = 3 + Math.random() * 9,
						ang = Math.random() * Math.PI * 2;
					const vx = Math.cos(ang) * speed * (0.6 + Math.random() * 1.4);
					const vy = Math.sin(ang) * speed * (0.6 + Math.random() * 1.4) - (2 + Math.random() * 3);
					const size = 3 + Math.random() * 5;
					fireworksParticles.push({ x: cx + (Math.random() - 0.5) * 8, y: cy + (Math.random() - 0.5) * 8, vx, vy, life: 80 + Math.floor(Math.random() * 50), size, color: colors[Math.floor(Math.random() * colors.length)], angle: Math.random() * Math.PI });
				}
			}

			function startFireworksBurst() {
				if (!ctx) return;
				fireworksParticles = [];
				for (let b = 0; b < 6; b++) { createBurst(Math.random() * confettiCanvas.width, Math.random() * confettiCanvas.height * 0.5 + confettiCanvas.height * 0.15, 80 + Math.floor(Math.random() * 80)); }
				const dur = 2200,
					start = performance.now();
				(function frame(now) {
					const t = now - start;
					ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
					for (let i = fireworksParticles.length - 1; i >= 0; i--) {
						const p = fireworksParticles[i];
						p.vx *= 0.995;
						p.vy += 0.25;
						p.x += p.vx;
						p.y += p.vy;
						p.life--;
						ctx.globalAlpha = Math.max(0, p.life / 120);
						ctx.fillStyle = p.color;
						ctx.beginPath();
						ctx.ellipse(p.x, p.y, p.size, p.size * 0.6, p.angle, 0, Math.PI * 2);
						ctx.fill();
						if (p.life <= 0 || p.y > confettiCanvas.height + 50) fireworksParticles.splice(i, 1);
					}
					ctx.globalAlpha = 1;
					if ((t < dur) || fireworksParticles.length > 0) requestAnimationFrame(frame);
					else ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
				})(performance.now());
			}

			function showWinnerOverlay(label, code) {
				document.getElementById('winnerFlagBig').src = `https://flagcdn.com/w320/${code}.png`;
				document.getElementById('winnerTitle').textContent = `Winner: ${label}`;
				overlay.classList.add('visible');
				overlay.setAttribute('aria-hidden', 'false');
				startFireworksBurst();
			}

			function hideOverlay() {
				overlay.classList.remove('visible');
				overlay.setAttribute('aria-hidden', 'true');
				fireworksParticles = [];
				if (ctx) ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
			}

			/* =================== FLAG MODAL =================== */
			const flagModalBackdrop = document.getElementById('flagModalBackdrop');
			const flagGrid = document.getElementById('flagGrid');
			let flagModalFor = null;

			function buildFlagGrid() {
				flagGrid.innerHTML = '';
				FIXED_COUNTRIES.forEach(c => {
					const div = document.createElement('div');
					div.className = 'flag-choice';
					div.innerHTML = `<img src="https://flagcdn.com/w80/${c.code}.png" alt="${c.code}">`;
					div.addEventListener('click', () => flagPick(c.code));
					flagGrid.appendChild(div);
				});
			}

			function openFlagModal(targetId) {
				flagModalFor = targetId;
				flagModalBackdrop.style.display = 'flex';
				flagModalBackdrop.setAttribute('aria-hidden', 'false');
			}

			function closeFlagModal() {
				flagModalFor = null;
				flagModalBackdrop.style.display = 'none';
				flagModalBackdrop.setAttribute('aria-hidden', 'true');
			}
			document.getElementById('closeFlagModal').addEventListener('click', closeFlagModal);
			flagModalBackdrop.addEventListener('click', e => { if (e.target === flagModalBackdrop) closeFlagModal(); });

			function flagPick(code) {
				if (!flagModalFor) return;
				if (flagModalFor === 'score-p1') {
					flagImg1.src = `https://flagcdn.com/w80/${code}.png`;
					flagImg1.dataset.country = code;
					countryLabel1.textContent = countryName(code);
				} else if (flagModalFor === 'score-p2') {
					flagImg2.src = `https://flagcdn.com/w80/${code}.png`;
					flagImg2.dataset.country = code;
					countryLabel2.textContent = countryName(code);
				} else if (flagModalFor.startsWith('input-')) {
					const idx = parseInt(flagModalFor.split('-')[1], 10);
					const img = document.getElementById('inpFlag_' + idx);
					if (img) {
						img.src = `https://flagcdn.com/w80/${code}.png`;
						img.dataset.country = code;
					}
				}
				closeFlagModal();
			}

			function countryName(code) {
				const map = { us: 'United States', ca: 'Canada', th: 'Thailand', cn: 'China', sg: 'Singapore', de: 'Germany', dk: 'Denmark', jp: 'Japan', np: 'Nepal', gb: 'England', fr: 'France', in: 'India', hk: 'Hong Kong', id: 'Indonesia', my: 'Malaysia', kr: 'South Korea', tw: 'Taiwan', au: 'Australia', es: 'Spain', it: 'Italy' };
				return map[code] || code.toUpperCase();
			}

			/* =================== SCOREBOARD INIT =================== */
			function initScoreboardDefaults() {
				setCountry(1, 'us');
				setCountry(2, 'us');
				updateDisplays();
				renderHistory();
			}

			function setCountry(p, code) {
				const img = (p === 1 ? flagImg1 : flagImg2);
				const lab = (p === 1 ? countryLabel1 : countryLabel2);
				img.src = `https://flagcdn.com/w80/${code}.png`;
				img.dataset.country = code;
				lab.textContent = countryName(code);
			}

			function setActiveNav(index){
			  document.querySelectorAll('.side-nav .nav-item')
			    .forEach((btn,i)=>btn.classList.toggle('active', i===index));
			}
			
			function showHome(){
			  document.getElementById('homeView')?.classList.remove('hidden');
			  document.getElementById('scoreboardView')?.classList.add('hidden');
			  document.getElementById('fixturesView')?.classList.add('hidden');
			  setActiveNav(0);
			  document.querySelector('.app-layout')?.classList.remove('nav-open');
			}			
			
			/* =================== EVENT LISTENERS =================== */document.querySelectorAll('.controls .btn').forEach(btn => {
			  attachFast(btn, () => {
					  const p = parseInt(btn.dataset.player, 10),
						 ch = parseInt(btn.dataset.change, 10);
					  vibrateShort();
					  if (ch === 1) addPoint(p);
					  else subtractPoint(p);
				 });
			});

			attachFast(document.getElementById('resetBtn'), () => {
				if (lockedMatch && !confirm('Reset this bracket match?')) return;
				vibrateShort();
				resetForNewMatch();
			});

			attachFast(document.getElementById('closeWinner'), () => {
				vibrateShort();
				hideOverlay();
			});
			attachFast(clearHistory, () => {
				localStorage.removeItem(HISTORY_KEY);
				renderHistory();
			});
			attachFast(document.getElementById('flagBtn1'), () => openFlagModal('score-p1'));
			attachFast(document.getElementById('flagBtn2'), () => openFlagModal('score-p2'));

			['name1', 'name2'].forEach((id, i) => {
				const el = document.getElementById(id);
				el.addEventListener('blur', () => { if (!el.textContent.trim()) el.textContent = i === 0 ? 'Player 1' : 'Player 2'; });
			});

			// ===== HOME: Premium modal + FAQ =====
			let __selectedPlan = 'monthly';
			
			function openPremium(plan){
			  __selectedPlan = plan || 'monthly';
			  const modal = document.getElementById('premiumModal');
			  const line = document.getElementById('premiumPlanLine');
			  if (line) line.textContent = 'Plan: ' + __selectedPlan.toUpperCase();
			  if (modal){
			    modal.classList.remove('hidden');
			    modal.setAttribute('aria-hidden','false');
			  }
			}
			
			function closePremium(){
			  const modal = document.getElementById('premiumModal');
			  if (modal){
			    modal.classList.add('hidden');
			    modal.setAttribute('aria-hidden','true');
			  }
			}
			
			function enablePremiumDemo(){
			  localStorage.setItem('premium_enabled', '1');
			  alert(
			    '‚úÖ Premium enabled (demo) on this device.\n' +
			    'Plan: ' + __selectedPlan.toUpperCase()
			  );
			  closePremium();
			}
			
			function toggleFaq(btn){
			  btn.classList.toggle('open');
			  const plus = btn.querySelector('.faq-plus');
			  if (plus){
			    plus.textContent = btn.classList.contains('open') ? '‚Äì' : '+';
			  }
			}			
			
			/* =================== FIXTURES STATE =================== */
			const FIXTURES_KEY = 'badminton_fixtures_v1';
			const fixturesState = {
				category: 'MS',
				dataByCat: loadFixtures() || {},
				currentRound: 0
			};
			
			function sanitizeCatData(x){
			  // Always return a safe {players:[], rounds:[]} object
			  const safe = { players: [], rounds: [] };
			  if (!x || typeof x !== 'object') return safe;
			  const players = Array.isArray(x.players) ? x.players : [];
			  const rounds  = Array.isArray(x.rounds)  ? x.rounds  : [];
			  return { players, rounds };
			}
			
			function loadFixtures() {
	  // Robust loader: tolerate corrupt/missing localStorage without crashing UI
			  try {
			    const raw = localStorage.getItem(FIXTURES_KEY);
			    if (!raw) return {};
			    const obj = JSON.parse(raw);
			    if (!obj || typeof obj !== 'object') return {};
			    const out = {};
			    Object.keys(obj).forEach(cat => { out[cat] = sanitizeCatData(obj[cat]); });
			    return out;
			  } catch (e) {
			    // If storage is corrupt, wipe it so app can recover
			    try { localStorage.removeItem(FIXTURES_KEY); } catch (_) {}
			    return {};
			  }
			}		

			function saveFixtures() {
			  try {
			    // Make sure dataByCat exists
			    if (!fixturesState.dataByCat || typeof fixturesState.dataByCat !== 'object') {
			      fixturesState.dataByCat = {};
			    }
			
			    // pick category safely (same logic as loadCategoryOrDefaults)
			    const catSel =
			      (typeof categorySelect !== 'undefined' && categorySelect)
			        ? categorySelect
			        : document.getElementById('categorySelect');
			
			    const cat = (catSel && catSel.value) ? catSel.value : (fixturesState.category || 'MS');
			    fixturesState.category = cat;
			
			    // ensure current category object exists
			    if (!fixturesState.dataByCat[cat] || typeof fixturesState.dataByCat[cat] !== 'object') {
			      fixturesState.dataByCat[cat] = { players: [], rounds: [], matchType: 3 };
			    }
			
			    // ‚úÖ SAVE EVERYTHING into the SINGLE KEY your loader uses
		    localStorage.setItem('badminton_fixtures_v1', JSON.stringify(fixturesState.dataByCat));
						 // ‚úÖ ALSO save per-category key (because loadCategoryOrDefaults reads fixtures_<CAT>)
							localStorage.setItem('fixtures_' + cat, JSON.stringify(fixturesState.dataByCat[cat]));
			  } catch (e) {
			    console.warn('saveFixtures failed', e);
			  }
			}			//end

			const catPill = document.getElementById('catPill');
			const catMenu = document.getElementById('catMenu');
			const catLabel = document.getElementById('catLabel');
			attachFast(catPill, () => {
				const vis = catMenu.classList.toggle('visible');
				catPill.setAttribute('aria-expanded', vis ? 'true' : 'false');
			});
			catMenu.querySelectorAll('.cat-item').forEach(it => {
				it.addEventListener('click', () => {
					fixturesState.category = it.dataset.cat;
					catLabel.textContent = fixturesState.category;
					catMenu.classList.remove('visible');
					loadCategoryOrDefaults();
				});
			});

			// === CLOSE CATEGORY DROPDOWN WHEN CLICKING OUTSIDE ===
			document.addEventListener("click", function(e) {
				const pill = document.getElementById("catPill");
				const menu = document.getElementById("catMenu");

				if (!pill || !menu) return;

				// If click is NOT on the pill AND NOT inside menu ‚Üí hide it
				if (!pill.contains(e.target) && !menu.contains(e.target)) {
					menu.classList.remove("visible");
					pill.setAttribute("aria-expanded", "false");
				}
			});

			const playerCountSel = document.getElementById('playerCount');
			const playerGrid = document.getElementById('playerGrid');
			const generateBtn = document.getElementById('generateBtn');
			const clearInputsBtn = document.getElementById('clearInputsBtn');
			const editPlayersBtn = document.getElementById('editPlayersBtn');
			const resetBracketBtn = document.getElementById('resetBracketBtn');
			const matchTypeSel = document.getElementById('matchType');

			// --- FIXED: Reset Bracket with Confirmation ---
			attachFast(resetBracketBtn, () => {
				if (!confirm("‚ö†Ô∏è This will completely reset all rounds and data.\nAre you sure?")) {
					return;
				}
				localStorage.removeItem("badminton_fixtures_v1");
				fixturesState.dataByCat = {};
				saveFixtures();
				showInputStage(true);
				alert("‚úÖ All rounds and fixtures cleared!");
			});

			playerCountSel.addEventListener('change', () => buildPlayerInputs(parseInt(playerCountSel.value, 10)));

			attachFast(clearInputsBtn, () => buildPlayerInputs(parseInt(playerCountSel.value, 10)));

			attachFast(generateBtn, () => {
				const count = parseInt(playerCountSel.value, 10);
				const players = collectPlayers(count);
				const mt = parseInt(matchTypeSel.value, 10);

				// --- NEW LOGIC: Treat blanks as BYE ---
				const entered = players.filter(p => p.name.trim() !== '');
				if (entered.length < 2) {
					alert('Enter at least 2 players (leave others blank for BYE)');
					return;
				}

				const total = nextPow2(entered.length);
				const byes = total - entered.length;

				// Fill blank slots with real BYEs
				const fullList = [...entered];
				for (let i = 0; i < byes; i++) {
					fullList.push({ name: 'BYE', flag: 'us', bye: true });
				}

				// Shuffle (optional)
				const filled = shuffle(fullList);

				// Build bracket
				const rounds = buildKnockoutRounds(filled);

				fixturesState.dataByCat[fixturesState.category] = {
					players: filled,
					rounds: rounds.map(r => r.map(m => ({ ...m }))),
					matchType: mt
				};

				fixturesState.currentRound = 0;
				saveFixtures();

				window.isEditingPlayers = false;

				showBracketStage();
				renderBracket();
			});

			function buildPlayerInputs(count) {
				const isDoubles = ['MD', 'WD', 'XD'].includes(fixturesState.category);
				playerGrid.innerHTML = '';
				for (let i = 0; i < count; i++) {
					const row = document.createElement('div');
					row.className = 'player-line';
					row.innerHTML = `
        <img id="inpFlag_${i}" class="flag-mini" src="https://flagcdn.com/w80/us.png" data-country="us" alt="flag">
        <input id="inpName_${i}" type="text" placeholder="${isDoubles ? 'Player A / Player B' : 'Player'} ${i+1}">
      `;
					playerGrid.appendChild(row);
					row.querySelector('.flag-mini').addEventListener('click', () => openFlagModal('input-' + i));
				}
			}

			function collectPlayers(count) {
				const arr = [];
				for (let i = 0; i < count; i++) {
					const name = (document.getElementById('inpName_' + i)?.value || '').trim();
					const flag = (document.getElementById('inpFlag_' + i)?.dataset.country) || 'us';
					arr.push({ name, flag });
				}
				return arr;
			}

			// ===== FIX: createEmptyBracket (used by loadCategoryOrDefaults) =====
			function createEmptyBracket(roundCount, playerCount) {
			  const rounds = [];
			  const makePlayer = () => ({ name: 'TBD', flag: 'us', bye: false });
			
			  // Round 0 has playerCount/2 matches
			  let matches = Math.max(1, Math.floor((playerCount || 2) / 2));
			
			  for (let r = 0; r < roundCount; r++) {
			    const arr = [];
			    for (let m = 0; m < matches; m++) {
			      arr.push({
			        p1: makePlayer(),
			        p2: makePlayer(),
			        winner: null,
			        scoreText: ''
			      });
			    }
			    rounds.push(arr);
			    matches = Math.max(1, Math.floor(matches / 2));
			  }
			
			  return { rounds };
			}
			// ===== END FIX =====			
			
			// ===== FIXED LOAD (single-key) =====
			function loadCategoryOrDefaults() {
			  // pick category safely
			  const catSel =
			    (typeof categorySelect !== 'undefined' && categorySelect)
			      ? categorySelect
			      : document.getElementById('categorySelect');
			
			  const cat = (catSel && catSel.value) ? catSel.value : (fixturesState.category || 'MS');
			  fixturesState.category = cat;
			
			  const key = 'fixtures_' + cat;
			
			  let loaded = null;
			
			  // 1) load raw
			  try {
			    const raw = localStorage.getItem(key);
			    if (raw) loaded = JSON.parse(raw);
			  } catch (e) {
			    console.warn('Saved fixtures corrupt for', cat, '‚Äî resetting', e);
			    try { localStorage.removeItem(key); } catch (_) {}
			    loaded = null;
			  }
			
			  // 2) base shape
			  if (!loaded || typeof loaded !== 'object') loaded = {};
			  if (!Array.isArray(loaded.players)) loaded.players = [];
			  if (!Array.isArray(loaded.rounds)) loaded.rounds = [];
			
			  // 3) DEEP sanitize rounds -> must be array of arrays of matches with p1/p2 objects
			  loaded.rounds = loaded.rounds.map(r => Array.isArray(r) ? r : []);
			  loaded.rounds = loaded.rounds.map(roundArr => {
			    return roundArr.map(m => {
			      const mm = (m && typeof m === 'object') ? m : {};
			      const p1 = (mm.p1 && typeof mm.p1 === 'object') ? mm.p1 : { name: "TBD", flag: "us" };
			      const p2 = (mm.p2 && typeof mm.p2 === 'object') ? mm.p2 : { name: "TBD", flag: "us" };
			      return {
			        ...mm,
			        p1: { name: (p1.name || "TBD"), flag: (p1.flag || "us"), bye: !!p1.bye },
			        p2: { name: (p2.name || "TBD"), flag: (p2.flag || "us"), bye: !!p2.bye },
			        scoreText: (typeof mm.scoreText === 'string') ? mm.scoreText : '',
			        winner: (mm.winner && typeof mm.winner === 'object') ? mm.winner : null
			      };
			    });
			  });
			
			  // save into state
			  fixturesState.dataByCat[cat] = loaded;
			
			  // make sure future rounds exist
			  try { ensureNextRounds(); } catch (e) { console.warn('ensureNextRounds failed', e); }

					// ‚úÖ Clamp currentRound so rounds[r] never becomes undefined
					try {
					  const data = fixturesState.dataByCat[fixturesState.category];
					  const rounds = data && Array.isArray(data.rounds) ? data.rounds : [];
					  if (!Number.isInteger(fixturesState.currentRound)) fixturesState.currentRound = 0;
					  if (fixturesState.currentRound < 0) fixturesState.currentRound = 0;
					  if (rounds.length > 0 && fixturesState.currentRound > rounds.length - 1) {
					    fixturesState.currentRound = 0;
					  }
					} catch (_) {
					  fixturesState.currentRound = 0;
					}					
			
			  // IMPORTANT: force a rebuild on every open
			  window.__bracketBuilt = false;
			
			  // If we already have rounds saved, jump to bracket stage so you can SEE it
			  try {
			    if (loaded.rounds && loaded.rounds.length > 0) {
			      if (typeof showBracketStage === 'function') showBracketStage();
			    } else {
			      if (typeof showInputStage === 'function') showInputStage(true);
			    }
			  } catch (_) {}
			
			  // render if fixtures view visible
			  try {
			    const fv = document.getElementById('fixturesView');
			    if (fv && !fv.classList.contains('hidden')) {
			      requestAnimationFrame(() => {
			        try { renderBracket(); }
			        catch (e) { console.warn('renderBracket failed:', (e && e.message) ? e.message : e, e); }
			      });
			    }
			  } catch (e) {
			    console.warn('loadCategoryOrDefaults render scheduling failed', e);
			  }
			}			

			function showInputStage(rebuild = false) {
				// ‚ú® FIX: If entering EDIT PLAYERS, do NOT rebuild inputs
				if (rebuild === true && window.isEditingPlayers === true) {
					rebuild = false; // stop deleting player names
				}
				document.getElementById('stageBefore').classList.remove('hidden');
				document.getElementById('stageAfter').classList.add('hidden');
				document.getElementById('inputStage').classList.remove('hidden');
				document.getElementById('bracketStage').classList.add('hidden');

				// Only rebuild on fresh setup (not edit)
				if (rebuild) {
					buildPlayerInputs(parseInt(playerCountSel.value, 10));
				}
			}

			function showBracketStage() {				document.getElementById('stageBefore').classList.add('hidden');				document.getElementById('stageAfter').classList.remove('hidden');				document.getElementById('inputStage').classList.add('hidden');				document.getElementById('bracketStage').classList.remove('hidden');
			}

			function shuffle(a) {
				const arr = a.slice();
				for (let i = arr.length - 1; i > 0; i--) {
					const j = Math.floor(Math.random() * (i + 1));
					[arr[i], arr[j]] = [arr[j], arr[i]];
				}
				return arr;
			}

			function buildKnockoutRounds(players) {
				const size = nextPow2(players.length);
				const slots = players.slice();
				while (slots.length < size) slots.push({ name: 'BYE', flag: 'us', bye: true });
				const rounds = [];
				let current = slots;
				while (current.length > 1) {
					const matches = [];
					for (let i = 0; i < current.length; i += 2) {
						matches.push({ p1: current[i], p2: current[i + 1], winner: null, scoreText: '', time: 'TBD' });
					}
					rounds.push(matches);
					current = new Array(matches.length).fill(null).map(() => ({ name: 'TBD', flag: 'us' }));
				}
				for (let r = 0; r < rounds.length; r++) {
					rounds[r].forEach((m, mi) => {
						if (m.p1.bye) {
							m.winner = m.p2;
							m.scoreText = 'w.o.';
							if (r < rounds.length - 1) {
								const next = rounds[r + 1][Math.floor(mi / 2)];
								if (mi % 2 === 0) next.p1 = m.p2;
								else next.p2 = m.p2;
							}
						} else if (m.p2.bye) {
							m.winner = m.p1;
							m.scoreText = 'w.o.';
							if (r < rounds.length - 1) {
								const next = rounds[r + 1][Math.floor(mi / 2)];
								if (mi % 2 === 0) next.p1 = m.p1;
								else next.p2 = m.p1;
							}
						}
					});
				}
				return rounds;
			}

			function nextPow2(n) { let p = 1; while (p < n) p *= 2; return p; }

			function roundName(r, totalRounds) {
				const stage = totalRounds - r;
				if (stage === 5) return 'Round 32';
				if (stage === 4) return 'Round 16';
				if (stage === 3) return 'Quarterfinals';
				if (stage === 2) return 'Semifinals';
				return 'Final';
			}

			const bracketContainer = document.getElementById('bracketContainer');
			const roundTitle = document.getElementById('roundTitle');
			const roundIndicator = document.getElementById('roundIndicator');
			const prevRound = document.getElementById('prevRound');
			const nextRound = document.getElementById('nextRound');
			
			// ‚úÖ If you delete the round-nav later, don't crash
			const HAS_ROUND_NAV = !!(roundTitle && roundIndicator && prevRound && nextRound);			
			let __roundRenderRAF = null;
			
			function stableRenderBracket(){
			  // the scroll container that actually scrolls in fixtures
			  const shell = document.querySelector('.fixture-shell') || document.getElementById('fixturesView');
			  const prevScroll = shell ? shell.scrollTop : 0;
			
			  const fixturesViewEl = document.getElementById('fixturesView');
			  if (fixturesViewEl) fixturesViewEl.classList.add('no-conn-anim');
			
			  const bc = document.getElementById('bracketContainer');
			  const holdH = bc ? bc.getBoundingClientRect().height : 0;
			  if (bc && holdH) bc.style.minHeight = holdH + "px";
			
			  renderBracket(); // keep your existing renderer
			
			  if (bc) bc.style.minHeight = "";
			
			  requestAnimationFrame(() => {
			    if (shell) shell.scrollTop = prevScroll;
			    if (fixturesViewEl) fixturesViewEl.classList.remove('no-conn-anim');
			  });
			}
						
			// ‚úÖ Ensure all future rounds are auto-filled with TBD slots
			function ensureNextRounds() {
				const data = fixturesState.dataByCat[fixturesState.category];
				if (!data) return;

				const rounds = data.rounds;

				for (let r = 1; r < rounds.length; r++) {
					const prev = rounds[r - 1];
					const curr = rounds[r];

					// ‚úÖ Only auto-fill if round is missing OR undefined
					if (!curr || curr.length === 0) {
						const newMatches = [];
						for (let i = 0; i < prev.length / 2; i++) {
							newMatches.push({
								p1: { name: "TBD", flag: "us" },
								p2: { name: "TBD", flag: "us" },
								scoreText: "",
								winner: null
							});
						}
						rounds[r] = newMatches;
					}
				}
			}
			// Make the bracket SVG as tall as the whole bracket, not just visible part
			function syncBracketSvgSize() {
				const container = document.getElementById('bracketContainer');
				const svg = document.getElementById('bracketConnections');
				if (!container || !svg) return;

				const h = container.scrollHeight; // full bracket height
				svg.setAttribute('height', h);
				svg.style.height = h + 'px';
			}

			// Bracket Spacing for better connectors
			function applyBracketSpacing() {
				const roundCols = document.querySelectorAll('.round-col');

				roundCols.forEach(col => {
					const r = parseInt(col.dataset.r); // round number (0,1,2,3)
					const matches = col.querySelectorAll('.match');

					// --- Round 16 stays default (no extra spacing)
					if (r === 0) {
						matches.forEach(m => m.style.marginTop = "8px");
						return;
					}

					// --- DEFAULT BASE SPACING PER ROUND:
					let baseSpacing = {
						1: 55, // Quarterfinals
						2: 230, // Semifinals
						3: 430 // Final
					};

					let base = baseSpacing[r];

					matches.forEach((m, index) => {
						// Read your manual adjustment (data-offset="30")
						let customOffset = parseInt(m.dataset.offset || "65");

						// Final vertical spacing value
						m.style.marginTop = (base + customOffset) + "px";
					});
				});
			}

			function clampRoundIndex(rounds) {
			  if (!Array.isArray(rounds) || rounds.length === 0) {
			    fixturesState.currentRound = 0;
			    return 0;
			  }
			  let r = Number(fixturesState.currentRound);
			  if (!Number.isFinite(r)) r = 0;
			  r = Math.max(0, Math.min(r, rounds.length - 1));
			  fixturesState.currentRound = r;
			  return r;
			}
			
			// ===== BRACKET RENDER CONTROL =====
			let __bracketBuilt = false;			
			
			// Render Brackets 
			function renderBracket() {
				const data = fixturesState.dataByCat[fixturesState.category];
				if (!data) return;

				// ‚úÖ FIX ‚Äî ensureNextRounds AFTER data loads
				ensureNextRounds();

				const rounds = Array.isArray(data.rounds) ? data.rounds : [];
				const r = clampRoundIndex(rounds);
				
				// If we have no rounds saved, don't try to render a bracket
				if (!rounds.length) {
				  // stay on Step 1 (inputs) if nothing exists
				  if (typeof showInputStage === 'function') showInputStage(false);
				  return;
				}				
				
				const roundTitleEl = document.getElementById('roundTitle');
				if (roundTitleEl) roundTitleEl.textContent = roundName(r, rounds.length);				

				// build ALL rounds
				bracketContainer.innerHTML = `
      <svg id="bracketConnections" class="svg_conn"></svg>
      <div class="round-wrap" id="roundWrap"></div>
    `;
				const wrap = document.getElementById('roundWrap');

				rounds.forEach((matches, ri) => {
					const col = document.createElement('div');
					col.className = 'round-col';
					col.dataset.r = ri;

					const title = document.createElement('div');
					title.className = 'round-col-title';
					title.textContent = roundName(ri, rounds.length);
					col.appendChild(title);

					matches.forEach((m, mi) => {
						const box = document.createElement('div');
						box.className = 'match';
						box.dataset.r = ri;
						box.dataset.i = mi;
						// default offset for every match card
						box.dataset.offset = "0";

						// ‚≠ê Quarterfinals (round 1)
						if (ri === 1 && mi === 0) box.dataset.offset = "25";
						if (ri === 1 && mi === 1) box.dataset.offset = "100";
						if (ri === 1 && mi === 2) box.dataset.offset = "115";
						if (ri === 1 && mi === 3) box.dataset.offset = "115";

						// ‚≠ê Semifinals (round 2)
						if (ri === 2 && mi === 0) box.dataset.offset = "-10";
						if (ri === 2 && mi === 1) box.dataset.offset = "231";

						// ‚≠ê Final (round 3)
						if (ri === 3 && mi === 0) box.dataset.offset = "75";

						const isBye1 = m.p1?.bye || m.p1?.name === 'BYE';
						const isBye2 = m.p2?.bye || m.p2?.name === 'BYE';

						const p1 = isBye1 ? 'BYE' : (m.p1?.name || 'TBD');
						const p2 = isBye2 ? 'BYE' : (m.p2?.name || 'TBD');
						const f1 = m.p1?.flag || 'us';
						const f2 = m.p2?.flag || 'us';

						const scoreText = m.scoreText || '';
						const isCompleted = !!scoreText && !scoreText.includes('w.o.');
						const games = scoreText ? scoreText.split(',').map(g => g.trim().split(/[‚Äì-]/)) : [];

						const makeScoreHTML = (idx) => {
						  if (!games || !games.length) return '';
						  // games entries may be either arrays like ['21','19'] (from scoreText parsing)
						  // or objects like {p1:21,p2:19} (if code uses objects). Handle both.
						  return `<div class="score-set">${games.map((v, gi) => {
						    // get numeric p1, p2 and the displayed text
						    let p1raw, p2raw;
						    if (Array.isArray(v)) {
						      p1raw = v[0];
						      p2raw = v[1];
						    } else if (v && typeof v === 'object') {
						      p1raw = String(v.p1);
						      p2raw = String(v.p2);
						    } else {
						      // fallback (shouldn't happen)
						      p1raw = '';
						      p2raw = '';
						    }
						
						    const a = p1raw === '' ? NaN : Number(p1raw);
						    const b = p2raw === '' ? NaN : Number(p2raw);
						
						    // determine winner for this game (compare numerically)
						    const isWinner = !isNaN(a) && !isNaN(b) ? (idx === 0 ? a > b : b > a) : false;
						    const cls = isWinner ? 'win-score' : 'lose-score';
						
						    // the text to display for this player's column (if missing show '')
						    const display = (idx === 0 ? p1raw : p2raw) || '';
						
						    return `<span class="${cls}">${display}</span>`;
						  }).join('')}</div>`;
						};						

						box.innerHTML = `
        <div class="match-inner"> 
          <div class="match-row">
            ${ri === 0 ? `<div class="match-index">${(mi * 2) + 1}</div>` : ""}
            <img class="flag-circle" src="https://flagcdn.com/w40/${f1}.png">
            <div class="name ${isBye1 ? 'bye' : ''}">${p1}</div>
            ${makeScoreHTML(0)}
            ${isCompleted && m.winner?.name === p1 ? '<div class="winner-dot"></div>' : ''}
          </div>

          <div class="match-row">
            ${ri === 0 ? `<div class="match-index">${(mi * 2) + 2}</div>` : ""}
            <img class="flag-circle" src="https://flagcdn.com/w40/${f2}.png">
            <div class="name ${isBye2 ? 'bye' : ''}">${p2}</div>
            ${makeScoreHTML(1)}
            ${isCompleted && m.winner?.name === p2 ? '<div class="winner-dot"></div>' : ''}
          </div>
        </div>
        <!-- Buttons OUTSIDE card -->
        ${ (p1 !== "TBD" && p2 !== "TBD") ? `
          <div class="match-actions">
            <button
              class="play-btn"
              data-round="${ri}"
              data-match="${mi}"
              ${isBye1 || isBye2 ? 'disabled' : ''}
            >Play</button>
            <button
              class="manual-btn"
              data-round="${ri}"
              data-match="${mi}"
              ${isBye1 || isBye2 ? 'disabled' : ''}
            >Manual</button>
          </div>
        ` : `` }
      `;
						// ‚úÖ Attach button listeners for THIS match card
						const playBtn = box.querySelector('.play-btn');
						const manualBtn = box.querySelector('.manual-btn');

						if (playBtn) {
							attachFast(playBtn, () => onMatchPicked(ri, mi));
						}
						if (manualBtn) {
							attachFast(manualBtn, () => openManualScore(ri, mi));
						}

						col.appendChild(box);
					});

					wrap.appendChild(col);
				});
								
				// FIX: Always reset connector SVG before drawing
				const svg = document.getElementById("bracketConnections");
				if (svg) svg.replaceChildren();

				requestAnimationFrame(() => {
				  applyBracketSpacing();
				  syncSvgSize();
				  drawAllConnectors();
				});	

				window.__bracketBuilt = true;				

				const walkoverNotice = document.getElementById('walkoverNotice');
				if (walkoverNotice) {
				  const safeRound = (Array.isArray(rounds) && Array.isArray(rounds[r])) ? rounds[r] : [];
				  const hasWO = safeRound.some(m => (m && m.scoreText && String(m.scoreText).toLowerCase().includes('w.o')));
				  walkoverNotice.classList.toggle('hidden', !hasWO);
				}				
			}
									
			function syncSvgSize() {
     const svg   = document.getElementById("bracketConnections");
     const wrap  = document.getElementById("roundWrap");

     if (!svg || !wrap) return;

     const rect = wrap.getBoundingClientRect();
     svg.setAttribute("width", rect.width);
     svg.setAttribute("height", rect.height);
   }
			
			// üî• NEW: drawAllConnectors with proper vertical alignment (BWF style)
			function drawAllConnectors() {
				 syncSvgSize();
					syncBracketSvgSize();	
					
					const svg = document.getElementById("bracketConnections");
					if (!svg) return;
	
					// ‚úÖ Clear paths WITHOUT flicker / WITHOUT breaking references
     while (svg.firstChild) svg.removeChild(svg.firstChild);
	
					const rounds = fixturesState.dataByCat[fixturesState.category].rounds;
					if (!rounds || rounds.length < 2) return;
	
					const svgRect = svg.getBoundingClientRect();
	
					for (let r = 0; r < rounds.length - 1; r++) {
						const currCol = document.querySelector(`.round-col[data-r="${r}"]`);
						const nextCol = document.querySelector(`.round-col[data-r="${r+1}"]`);
						if (!currCol || !nextCol) continue;
	
						const currMatches = currCol.querySelectorAll(".match");
						const nextMatches = nextCol.querySelectorAll(".match");
	
						for (let i = 0; i < currMatches.length; i += 2) {
							const a = currMatches[i];
							const b = currMatches[i + 1];
							const t = nextMatches[Math.floor(i / 2)];
	
							if (!a || !b || !t) continue;
	
							const aRect = a.getBoundingClientRect();
							const bRect = b.getBoundingClientRect();
							const tRect = t.getBoundingClientRect();
	
							const y1 = aRect.top + aRect.height / 2 - svgRect.top;
							const y2 = bRect.top + bRect.height / 2 - svgRect.top;
							const midY = (y1 + y2) / 2;
	
							const x1 = aRect.right - svgRect.left;
							const x2 = tRect.left - svgRect.left;
							const xMid = (x1 + x2) / 2;
	
							const p = document.createElementNS("http://www.w3.org/2000/svg", "path");
							p.setAttribute("d", `
	        M ${x1} ${y1} H ${xMid}
	        M ${x1} ${y2} H ${xMid}
	        M ${xMid} ${y1} V ${y2}
	        M ${xMid} ${midY} H ${x2}
	      `);
							p.setAttribute("stroke", "#fff");
							p.setAttribute("stroke-width", "1.6");
							p.setAttribute("stroke-opacity", "0.38");
							p.setAttribute("fill", "none");
	
							svg.appendChild(p);
						}
				 }
			}			

			// helper to add the green check instantly
			function showSyncedBadge(box) {
				let existing = box.querySelector('.synced-badge');
				if (!existing) {
					const badge = document.createElement('div');
					badge.className = 'synced-badge';
					badge.textContent = '‚úî Synced';
					box.appendChild(badge);
				}
			}

			/* Manual Score Modal */
			const manualScoreBackdrop = document.getElementById('manualScoreBackdrop');
			const gameInputs = document.getElementById('gameInputs');
			const submitManualScore = document.getElementById('submitManualScore');
			const closeManualScore = document.getElementById('closeManualScore');
			let manualMatch = null;

			attachFast(closeManualScore, () => manualScoreBackdrop.classList.remove('visible'));
			manualScoreBackdrop.addEventListener('click', e => { if (e.target === manualScoreBackdrop) manualScoreBackdrop.classList.remove('visible'); });
						
			function isValidGame(p1, p2) {
			  // allow empty (both blank) so user can skip unused games
			  if (p1 === "" && p2 === "") return true;
			  if (p1 === "" || p2 === "") return false;
			
			  const a = Number(p1);
			  const b = Number(p2);
			
			  if (isNaN(a) || isNaN(b)) return false;
			  if (a < 0 || b < 0 || a > 30 || b > 30) return false;
			  if (a === b) return false;
			
			  // Special allowed finish 30-29
			  if ((a === 30 && b === 29) || (b === 30 && a === 29)) return true;
			
			  const max = Math.max(a, b);
			  const min = Math.min(a, b);
			  const diff = Math.abs(a - b);
			
			  // If winner < 21 -> invalid (must reach at least 21 to win)
			  if (max < 21) return false;
			
			  // If winner > 21 (i.e. 22+), loser MUST have reached 20 (deuce rule).
			  if (max > 21 && min < 20) return false;
			
			  // Normal rule: winner must lead by 2 (except 30-29 already handled)
			  if (diff < 2) return false;
			
			  return true;
			}			
			
			function openManualScore(roundIndex, matchIndex) {
				const data = fixturesState.dataByCat[fixturesState.category];
				const match = data.rounds[roundIndex][matchIndex];
				const mt = data.matchType;
				gameInputs.innerHTML = '';
				for (let i = 0; i < mt; i++) {
					const row = document.createElement('div');
					row.className = 'game-row';
					row.innerHTML = `
        <label>Game ${i+1}:</label>
        <input type="number" id="gameP1_${i}" placeholder="P1 Score" min="0">
        <input type="number" id="gameP2_${i}" placeholder="P2 Score" min="0">
      `;
					gameInputs.appendChild(row);
				}
				manualMatch = { cat: fixturesState.category, roundIndex, matchIndex };
				manualScoreBackdrop.classList.add('visible');
			}

			attachFast(submitManualScore, () => {
			  const data = fixturesState.dataByCat[manualMatch.cat];
				 const match = data.rounds[manualMatch.roundIndex][manualMatch.matchIndex];
				 const mt = data.matchType;
								
				 const games = [];
       for (let i = 0; i < mt; i++) {
							  const p1raw = document.getElementById(`gameP1_${i}`).value.trim();
         const p2raw = document.getElementById(`gameP2_${i}`).value.trim();

									// skip empty row
									if (!p1raw && !p2raw) continue;
									
									// quick sanity parse
									if (!isValidGame(p1raw, p2raw)) {
									  alert(`Invalid game ${i+1}: "${p1raw} - ${p2raw}". Check badminton rules (must reach 21, win by 2; extended scores require both >=20; 30‚Äì29 allowed).`);
									  return;
									}
									
									const p1 = parseInt(p1raw, 10);
									const p2 = parseInt(p2raw, 10);
									games.push({ p1, p2 });
    }
				// üî• Badminton validation: must win by 2 points except 30‚Äì29
				for (const g of games) {
		    const p1 = g.p1;
		    const p2 = g.p2;
		    const max = Math.max(p1, p2);
		    const diff = Math.abs(p1 - p2);
		
		    // Must reach at least 21 to win any game
		    if (max < 21) {
		      alert("Each game must reach at least 21 points.");
		      return;
		    }
				
				  // Normal rule: win by 2 points
				  if (max < 30 && diff < 2) {
				    alert("Player must win by 2 points (except 30‚Äì29).");
				    return;
				  }
				
				  // Special case: only 30‚Äì29 allowed
				  if (max === 30 && diff !== 1) {
				    alert("At 29‚Äì29, the only valid winning score is 30‚Äì29.");
				    return;
				  }
				}				
				
    const games1 = games.filter(g => g.p1 > g.p2).length;
			 const games2 = games.filter(g => g.p2 > g.p1).length;
			 const need = Math.ceil(mt / 2);
			
			 // use >= so we accept exact or over (safer)
			 if (games1 >= need || games2 >= need) {
			   const isP1Win = games1 > games2;
			   match.winner = isP1Win ? match.p1 : match.p2;
			
			   // IMPORTANT: store plain score text (numbers joined with an en-dash and comma)
			   // e.g. "21‚Äì19, 19‚Äì21"
			   match.scoreText = games.map(g => `${g.p1}‚Äì${g.p2}`).join(', ');
												
			   // (rest of your next-round propagation code follows unchanged)
			   const nextRoundIndex = manualMatch.roundIndex + 1;
			   if (nextRoundIndex < data.rounds.length) {
			     const nextMatchIndex = Math.floor(manualMatch.matchIndex / 2);
			     const nextMatch = data.rounds[nextRoundIndex][nextMatchIndex];
			     if (manualMatch.matchIndex % 2 === 0) nextMatch.p1 = match.winner;
			     else nextMatch.p2 = match.winner;
			     if (nextMatch.p1.bye) {
			       nextMatch.winner = nextMatch.p2;
			       nextMatch.scoreText = 'w.o.';
			     } else if (nextMatch.p2.bye) {
			       nextMatch.winner = nextMatch.p1;
			       nextMatch.scoreText = 'w.o.';
			     }
			   }
			   saveFixtures();
			   renderBracket();
			  manualScoreBackdrop.classList.remove('visible');
					
			} else {
			  alert('Invalid number of wins for best of ' + mt);
			}
   });			

			function onMatchPicked(roundIndex, matchIndex) {
				const data = fixturesState.dataByCat[fixturesState.category];
				if (!data) return;
				const match = data.rounds[roundIndex][matchIndex];
				if (!match) return;
				if (match.winner && !confirm('Match already finished. Change winner?')) return;

				name1.textContent = match.p1?.name || 'Player 1';
				name2.textContent = match.p2?.name || 'Player 2';
				setCountry(1, match.p1?.flag || 'us');
				setCountry(2, match.p2?.flag || 'us');

				resetForNewMatch();
				currentMatchType = Number(data.matchType) || 3;
				lockedMatch = { cat: fixturesState.category, roundIndex, matchIndex };
				scoreLockBanner.textContent = `Scoring: ${match.p1?.name||'TBD'} vs ${match.p2?.name||'TBD'} ‚Ä¢ ${roundName(roundIndex, data.rounds.length)}`;
				scoreLockBanner.style.display = 'block';
				showScoreboardPage();
			}

			// ===== FIXTURES: instant update flags (paste once) =====
			window.__fixturesDirty = false;
			window.__fixturesRAF = 0;
			window.__fixturesEverRendered = false;
			
			function markFixturesDirty(){
			  window.__fixturesDirty = true;
			}			
			
			function applyScoreToBracket(lockRef, result) {
			  const data = fixturesState.dataByCat[lockRef.cat];
			  if (!data) return;
			
			  const match = data.rounds?.[lockRef.roundIndex]?.[lockRef.matchIndex];
			  if (!match) return;
			
			  const winnerName = (result.winnerName || '').trim().toLowerCase();
			  const isP1 = match.p1 && (match.p1.name || '').trim().toLowerCase() === winnerName;
			  const winObj = isP1 ? match.p1 : match.p2;
			
			  match.winner = winObj;
			
			  // Force clean display
			  match.scoreText = (result.games || [])
			    .map(g => `${Number(g.p1)}‚Äì${Number(g.p2)}`)
			    .join(', ');
			
			  // advance winner
			  const nextRoundIndex = lockRef.roundIndex + 1;
			  if (nextRoundIndex < data.rounds.length) {
			    const nextMatchIndex = Math.floor(lockRef.matchIndex / 2);
			    const nextMatch = data.rounds[nextRoundIndex][nextMatchIndex];
			
			    if (lockRef.matchIndex % 2 === 0) nextMatch.p1 = winObj;
			    else nextMatch.p2 = winObj;
			
			    if (nextMatch.p1?.bye) {
			      nextMatch.winner = nextMatch.p2;
			      nextMatch.scoreText = 'w.o.';
			    } else if (nextMatch.p2?.bye) {
			      nextMatch.winner = nextMatch.p1;
			      nextMatch.scoreText = 'w.o.';
			    }
			  }
			
			  saveFixtures();
			
			  // ‚úÖ mark fixtures dirty so showFixtures re-renders
			  window.__fixturesDirty = true;
			
			  // ‚úÖ if fixtures is open RIGHT NOW, redraw instantly
			  const fv = document.getElementById('fixturesView');
			  if (fv && !fv.classList.contains('hidden')) {
			    requestAnimationFrame(() => {
			      try { renderBracket(); } catch (e) {}
			      window.__fixturesDirty = false;
			    });
			  }
			}			
			
			/* =================== FINAL INIT =================== */
			buildFlagGrid();
			initScoreboardDefaults();
			playerCountSel.addEventListener('change', () => buildPlayerInputs(parseInt(playerCountSel.value, 10)));

			// ===== KEEP CONNECTORS ALIGNED ON RESIZE OR SCROLL =====
			window.addEventListener('resize', () => {
				try {
					renderBracket();
				} catch (e) {}
			});

			// ‚úÖ GLOBAL view switchers (Home + Scoreboard + Fixtures)
			window.showHomePage = function () {
			  const h = document.getElementById('homeView');
			  const s = document.getElementById('scoreboardView');
			  const f = document.getElementById('fixturesView');
			
			  if (h) h.classList.remove('hidden');
			  if (s) s.classList.add('hidden');
			  if (f) f.classList.add('hidden');
			};
			
			window.showScoreboardPage = function () {
			  const h = document.getElementById('homeView');
			  const s = document.getElementById('scoreboardView');
			  const f = document.getElementById('fixturesView');
			
			  if (h) h.classList.add('hidden');
			  if (s) s.classList.remove('hidden');
			  if (f) f.classList.add('hidden');
			};
			
			window.showFixturesPage = function () {
			  const h = document.getElementById('homeView');
			  const s = document.getElementById('scoreboardView');
			  const f = document.getElementById('fixturesView');
			
			  if (h) h.classList.add('hidden');
			  if (s) s.classList.add('hidden');
			  if (f) f.classList.remove('hidden');
			};			

			// ================== FIXED EDIT PLAYERS BUTTON ==================
			document.getElementById('editPlayersBtn').addEventListener('click', () => {
				if (!confirm("‚ö†Ô∏è Editing players will reset match progress,\nbut WILL NOT erase names.\nContinue?"))
					return;
				const data = fixturesState.dataByCat[fixturesState.category];

				// If no bracket exists yet ‚Üí open input normally
				if (!data || !data.players) {
					showInputStage(true);
					return;
				}

				const players = data.players;
				const count = players.length;

				// üî• tell system this is edit mode (NO rebuilding)
				window.isEditingPlayers = true;

				// Show input stage WITHOUT resetting fields
				showInputStage(false);

				// Match input count to the same number of players
				playerCountSel.value = count;

				// Build that many input fields
				buildPlayerInputs(count);

				// üî• Restore existing names + flags into the inputs
				for (let i = 0; i < count; i++) {
					const p = players[i];
					const nameInput = document.getElementById(`inpName_${i}`);
					const flagInput = document.getElementById(`inpFlag_${i}`);

					// SKIP BYE when filling inputs
					if (nameInput) {
						nameInput.value = (p.bye || p.name === "BYE") ? "" : p.name;
					}
					if (flagInput) {
						if (p.bye || p.name === "BYE") {
							flagInput.dataset.country = "us";
							flagInput.src = "https://flagcdn.com/w80/us.png";
						} else {
							flagInput.dataset.country = p.flag || "us";
							flagInput.src = `https://flagcdn.com/w80/${p.flag || "us"}.png`;
						}
					}
				}			
							
			});
			
			// ================== V10 NAV LOGIC (FIXED ACTIVE + HOME) ==================
			const layout = document.querySelector('.app-layout');
			const navToggle = document.getElementById('navToggle');
			const navOverlay = document.getElementById('navOverlay');
			
			function closeNav() {
			  if (layout) layout.classList.remove('nav-open');
			}
			function toggleNav() {
			  if (layout) layout.classList.toggle('nav-open');
			}
			
			if (navToggle) navToggle.addEventListener('click', toggleNav);
			if (navOverlay) navOverlay.addEventListener('click', closeNav);
			
			// helper: show ONLY one view
			function showOnly(viewId) {
			  const ids = ['homeView', 'scoreboardView', 'fixturesView', 'settingsView'];
			  ids.forEach(id => {
			    const el = document.getElementById(id);
			    if (!el) return;
			    el.classList.toggle('hidden', id !== viewId);
			  });
			}
			
			function setActiveNav(i) {
			  // IMPORTANT: only sidebar buttons
			  document.querySelectorAll('.side-nav .nav-item').forEach((b, idx) => {
			    b.classList.toggle('active', idx === i);
			  });
			}
			
			// ‚úÖ GLOBAL functions (onclick can always find them)
			window.showHome = function () {
			  showOnly('homeView');
			  setActiveNav(0);           // Home is button #0
			  if (window.innerWidth <= 900) closeNav();
			};
			
			window.showScoreboard = function () {
			  // use your existing scoreboard/fixture logic if you want,
			  // but ALSO hide home:
			  if (typeof showScoreboardPage === 'function') showScoreboardPage();
			  showOnly('scoreboardView');
			  setActiveNav(1);           // Scoreboard is button #1
			  if (window.innerWidth <= 900) closeNav();
			};
			
			window.showFixtures = function () {
			  // show the fixtures view
			  showOnly('fixturesView');
			  setActiveNav(2);
			  document.title = 'Tournament Fixture';
			
			  // ALWAYS load category + saved rounds every time we enter
			  try {
			    if (typeof loadCategoryOrDefaults === 'function') loadCategoryOrDefaults();
			  } catch (e) {
			    console.warn('loadCategoryOrDefaults failed', e);
			  }
			
			  // If we have saved rounds, always switch to bracket stage
			  try {
			    const catSel = document.getElementById('categorySelect');
			    const cat = (catSel && catSel.value) ? catSel.value : (fixturesState?.category || 'MS');
			    if (fixturesState) fixturesState.category = cat;
			
			    const data = fixturesState?.dataByCat?.[cat];
			
			    if (data && Array.isArray(data.rounds) && data.rounds.length > 0) {
			      if (typeof showBracketStage === 'function') showBracketStage();
			      window.__bracketBuilt = false; // force rebuild
			    } else {
			      if (typeof showInputStage === 'function') showInputStage(true);
			    }
			  } catch (e) {
			    console.warn('fixtures stage select failed', e);
			  }
			
			  // ALWAYS re-render (even if bracketContainer is empty)
			  if (window.__fixturesRAF) cancelAnimationFrame(window.__fixturesRAF);
			  window.__fixturesRAF = requestAnimationFrame(() => {
			    window.__fixturesRAF = 0;
			    try {
			      // prefer stableRenderBracket if you have it, otherwise renderBracket
			      if (typeof stableRenderBracket === 'function') stableRenderBracket();
			      else renderBracket();
			    } catch (e) {
			      console.warn('renderBracket failed:', (e && e.message) ? e.message : e, e);
			    }
			  });
			
			  if (window.innerWidth <= 900) closeNav();
			};			

			// ===== HOME: Premium modal + FAQ (GLOBAL) =====
			window.__selectedPlan = window.__selectedPlan || 'monthly';
			
			function markSelectedPlan(plan){
			  document.querySelectorAll('.price-card[data-plan]').forEach(card=>{
			    card.classList.toggle('is-selected', card.dataset.plan === plan);
			  });
			}
			
			window.openPremium = function(plan){
			  window.__selectedPlan = plan || 'monthly';
			
			  const modal = document.getElementById('premiumModal');
			  const line  = document.getElementById('premiumPlanLine');
			
			  if (line) line.textContent = 'Plan: ' + window.__selectedPlan.toUpperCase();
			
			  // highlight selected plan card
			  markSelectedPlan(window.__selectedPlan);
			
			  if (modal){
			    modal.classList.remove('hidden');
			    modal.setAttribute('aria-hidden','false');
			    document.body.classList.add('modal-open');
			  }
			};
			
			window.closePremium = function(){
			  const modal = document.getElementById('premiumModal');
			  if (modal){
			    modal.classList.add('hidden');
			    modal.setAttribute('aria-hidden','true');
			  }
			  document.body.classList.remove('modal-open');
			};			
			
			window.enablePremiumDemo = function(){
			  localStorage.setItem('premium_enabled', '1');
			  alert('‚úÖ Premium enabled (demo) on this device.\nPlan: ' + window.__selectedPlan.toUpperCase());
			  window.closePremium();
			};
			
			window.toggleFaq = function(btn){
			  btn.classList.toggle('open');
			  const plus = btn.querySelector('.faq-plus');
			  if (plus) plus.textContent = btn.classList.contains('open') ? '‚Äì' : '+';
			};			

			// Close modal by tapping outside
			(function initPremiumCloseUX(){
			  const modal = document.getElementById('premiumModal');
			  if (modal && !modal.__closeUXBound){
			    modal.__closeUXBound = true;
			    modal.addEventListener('click', (e)=>{
			      if (e.target === modal) window.closePremium(); // only backdrop click
			    });
			  }
			
			  // Close modal with ESC key (desktop)
			  if (!window.__premiumEscBound){
			    window.__premiumEscBound = true;
			    document.addEventListener('keydown', (e)=>{
			      if (e.key === 'Escape'){
			        const m = document.getElementById('premiumModal');
			        if (m && !m.classList.contains('hidden')) window.closePremium();
			      }
			    });
			  }
			})();
			
			/* ================= SETTINGS ================= */
			window.showSettings = function(){
			  showOnly('settingsView');
			  setActiveNav(3); // Settings = nav index 3
			  document.title = 'Settings';
			  if (window.innerWidth <= 900) closeNav();
			};
			
			// settings state
			let soundsEnabled = true;
			
			function setSoundsEnabled(on){
			  soundsEnabled = !!on;
			  localStorage.setItem('soundsEnabled', soundsEnabled ? '1' : '0');
			}
			
			function setLightMode(on){
			  document.body.classList.toggle('light-mode', !!on);
			  localStorage.setItem('lightMode', on ? '1' : '0');
			}

			// ===== ACCOUNT (LOCAL DEMO AUTH) =====
			window.showAccount = function(){
			  showOnly('accountView');
			  setActiveNav?.(4); // optional (only if you have setActiveNav)
			  renderAuth();
			  if (window.innerWidth <= 900) closeNav?.();
			};
			
			function getAuthUser(){
			  try { return JSON.parse(localStorage.getItem('auth_user') || 'null'); }
			  catch(e){ return null; }
			}
			function setAuthUser(u){
			  localStorage.setItem('auth_user', JSON.stringify(u));
			}
			
			window.registerLocal = function(){
			  const email = document.getElementById('regEmail')?.value.trim();
			  const pass  = document.getElementById('regPass')?.value.trim();
			  if(!email || !pass) return alert('Enter email + password');
			  setAuthUser({ id: email.toLowerCase(), email: email.toLowerCase() });
			  localStorage.setItem('auth_pass_' + email.toLowerCase(), pass);
			  renderAuth();
			  alert('‚úÖ Account created (demo).');
			};
			
			window.loginLocal = function(){
			  const email = document.getElementById('loginEmail')?.value.trim().toLowerCase();
			  const pass  = document.getElementById('loginPass')?.value.trim();
			  if(!email || !pass) return alert('Enter email + password');
			  const saved = localStorage.getItem('auth_pass_' + email);
			  if(saved !== pass) return alert('Wrong email or password (demo)');
			  setAuthUser({ id: email, email });
			  renderAuth();
			};
			
			window.logout = function(){
			  localStorage.removeItem('auth_user');
			  renderAuth();
			};
			
			function renderAuth(){
			  const u = getAuthUser();
			  const out = document.getElementById('authLoggedOut');
			  const inn = document.getElementById('authLoggedIn');
			  if(!out || !inn) return;
			
			  if(!u){
			    out.classList.remove('hidden');
			    inn.classList.add('hidden');
			  } else {
			    out.classList.add('hidden');
			    inn.classList.remove('hidden');
			    const el = document.getElementById('accountEmail');
			    if(el) el.textContent = 'Signed in as: ' + u.email;
			  }
			}
			
			// placeholder until Stripe is wired
			window.openManageSubscription = function(){
			  alert('üîí Coming next: Stripe subscription portal.\nFor now this is UI only.');
			};
			
			window.exportMyData = function(){
			  const u = getAuthUser();
			  if(!u) return alert('Login first');
			  const key = 'tournaments_' + u.id;
			  const data = localStorage.getItem(key) || '[]';
			  console.log('EXPORT', key, data);
			  alert('Exported to console (demo)');
			};
			
			window.clearMyData = function(){
			  const u = getAuthUser();
			  if(!u) return alert('Login first');
			  if(!confirm('Clear your saved tournaments on this device?')) return;
			  localStorage.removeItem('tournaments_' + u.id);
			  alert('‚úÖ Cleared.');
			};	
			
			// init toggles once
			(function initSettings(){
			  const lightOn = localStorage.getItem('lightMode') === '1';
			  const soundOn = localStorage.getItem('soundsEnabled') !== '0';
			
			  setLightMode(lightOn);
			  setSoundsEnabled(soundOn);
			
			  const lightToggle = document.getElementById('lightToggle');
			  const soundToggle = document.getElementById('soundToggle');
			
			  if (lightToggle) lightToggle.checked = lightOn;
			  if (soundToggle) soundToggle.checked = soundOn;
			
			  lightToggle && lightToggle.addEventListener('change', e => setLightMode(e.target.checked));
			  soundToggle && soundToggle.addEventListener('change', e => setSoundsEnabled(e.target.checked));
			})();			
			
			// Default page 
			window.showHome();
		});
</script>
    </div> <!-- end #app -->
  </main>
</div> <!-- end app-layout -->
</body>
</html>
